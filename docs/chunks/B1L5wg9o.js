var To=Object.defineProperty;var Po=(o,e,t)=>e in o?To(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>(Po(o,typeof e!="symbol"?e+"":e,t),t);import{j as H,a as d,C as Bo,b as Oe,c as Eo,d as ko,u as Ps,e as Te,f as ot,s as Lo,g as Ao,h as Do,i as Bs,k as Oo,L as zo,l as Ft,D as Ho,m as Uo,n as Fo,F as ht,A as wt,o as Ct,p as D,M as dt,q as bt,r as et,G as O,t as m,B as re,O as ae,P as ze,v as No,S as Go,w as Vo,x as He,y as Ue,z as Fe,E as Ne,H as Ge,I as Ve,J as We,K as Wo,N as jo,Q as _o,R as Pt,T as Xo,U as je,V as j,W as Yo,X as Zo,_ as Ko,Y as $o,Z as qo,$ as Jo,a0 as Es,a1 as ks,a2 as rt,a3 as At,a4 as Ot,a5 as we,a6 as Ls,a7 as As,a8 as Qo,a9 as ti,aa as ei}from"../utx7zdQs.js";import{r as v,a as G}from"./nMcGvdtL.js";import{g as si,b as zt,I as oi,i as _e,e as Ce}from"./qn0Ax5GX.js";import{d as it,S as Tt,c as It,h as ct,y as ii,ag as ni,ah as ri,I as Ds,C as te,a as Os,b as ee,W as K,T as Nt,ai,l as li,aj as hi,m as Xt,u as Xe,o as ci,R as ui,n as zs,ak as di,al as fi,am as mi}from"./Xd67X8bR.js";import{p as a}from"./x5007UNk.js";import{_ as le}from"./30oZtftA.js";import"./3Ca9RTBR.js";import"./l4hw3P92.js";import"./h5Fee5Mf.js";const gi=o=>{const[e,t]=v.useState({width:0,height:0});return v.useEffect(()=>{if(!o.current)return;const s=new ResizeObserver(i=>{const{width:n,height:r}=i[0].contentRect;t({width:n,height:r})});return s.observe(o.current),()=>{s.disconnect()}},[o]),e},pi=({img:o,name:e,size:t,active:s=!1,deleable:i=!0,onDelete:n,...r})=>H(ko,{active:s,...r,children:[d(Bo,{src:o}),d(Oe,{title:e,active:s}),t&&d(Oe,{title:`${t[0]} x ${t[1]}`,active:s}),s&&i&&d(Eo,{onClick:n})]}),Ye=v.memo(v.forwardRef(({spriteId:o,dataSource:e,active:t,opacity:s=1,deleable:i},n)=>{const r=Ps(),l=Te(),{id:u,assetId:c,name:f}=e,g=ot(I=>{I.stopPropagation(),l.deleteCostume(o,u)}),C=ot(()=>{const I=l.getTarget(o);I&&(I.setCurrentCostumeById(u),r(Lo(I.getCurrentCostume().toJSON())))}),w=l.assetStorage.get(c),y=v.useMemo(()=>w?si(w==null?void 0:w.data):"",[w==null?void 0:w.data]),{attributes:L,listeners:x,setNodeRef:T,transform:A,transition:R}=Ao({id:u});return d(pi,{cardRef:I=>{T(I),typeof n=="function"&&n(I)},sx:{transform:Do.Transform.toString(A),transition:R,opacity:s},active:t,deleable:i,img:y,name:f,...L,...x,onDelete:g,onClick:C})})),vi=v.memo(({targetId:o})=>{const e=Te(),t=Bs(),s=e.getTarget(o),i=(s==null?void 0:s.costumes.map(w=>w.toJSON()))??[],n=v.useRef(null),{height:r}=gi(n),{items:l,sensors:u,onDragStart:c,onDragEnd:f,activeItem:g}=Oo({dataSource:i,itemKey:"id",onSort:(w,y)=>{e.sortSpriteCostumes(o,w,y)}}),C=v.useId();return d(it,{ref:n,sx:{height:"100%",p:.5},children:r>0?H(Uo,{items:l,sensors:u,onDragStart:c,onDragEnd:f,children:[d(zo,{style:{width:Ft},styles:{verticalScrollBar:{display:"none"}},data:l.concat("placeholder"),height:r,itemHeight:Ft,itemKey:w=>w,children:(w,y)=>w==="placeholder"?d(it,{sx:{height:Ft}},w):d(Ye,{spriteId:o,dataSource:i[y],active:(t==null?void 0:t.id)===i[y].id,opacity:g&&g.id===w?.5:1,deleable:i.length>1},w)}),d(Ho,{children:g&&d(Ye,{spriteId:o,dataSource:g,active:(t==null?void 0:t.id)===g.id})})]},C):d(it,{sx:{width:Ft}},C)})}),wi=v.memo(({targetId:o})=>H(Tt,{sx:{position:"relative"},children:[d(vi,{targetId:o}),d(it,{sx:{position:"absolute",bottom:4,left:"50%",transform:"translateX(-50%)"},children:d(Fo,{targetId:o})})]})),Ci=o=>o.includes("BIT_"),Yt=o=>o===ht.VECTOR||o===ht.VECTOR_SKIP_CONVERT,Hs=o=>o===ht.BITMAP||o===ht.BITMAP_SKIP_CONVERT,X=class X{};h(X,"getRootItem",e=>e.parent.className==="Layer"?e:X.getRootItem(e.parent)),h(X,"isBoundsItem",e=>e.className==="PointText"||e.className==="Shape"||e.className==="PlacedSymbol"||e.className==="Raster"),h(X,"isPathItem",e=>e.className==="Path"),h(X,"isCompoundPathItem",e=>e.className==="CompoundPath"),h(X,"isGroupItem",e=>e.className==="Group"),h(X,"isPointTextItem",e=>e.className==="PointText"),h(X,"isPGTextItem",e=>X.getRootItem(e).data.isPGTextItem),h(X,"setPivot",(e,t)=>{X.isBoundsItem(e)?e.pivot=e.globalToLocal(t):e.pivot=t}),h(X,"getPositionInView",e=>{const t=new a.Point(0,0);return t.x=e.position.x-a.view.bounds.x,t.y=e.position.y-a.view.bounds.y,t}),h(X,"setPositionInView",(e,t)=>{e.position.x=a.view.bounds.x+t.x,e.position.y=a.view.bounds.y+t.y});let z=X;const p=class p{static clear(){for(const e of a.project.layers)e.data.isRasterLayer?this.clearRaster():!e.data.isBackgroundGuideLayer&&!e.data.isDragCrosshairLayer&&!e.data.isOutlineLayer&&e.removeChildren()}};h(p,"CHECKERBOARD_SIZE",8),h(p,"CROSSHAIR_SIZE",16),h(p,"CROSSHAIR_FULL_OPACITY",.75),h(p,"createCanvas",(e,t)=>{const s=document.createElement("canvas");return s.width=e||wt,s.height=t||Ct,s.getContext("2d").imageSmoothingEnabled=!1,s}),h(p,"hideGuideLayers",e=>{const t=p.getBackgroundGuideLayer(),s=p.getDragCrosshairLayer(),i=p.getOutlineLayer(),n=p.getGuideLayer();s.remove(),i.remove(),n.remove(),t.remove();let r;return e&&(r=p.getRasterLayer(),r.remove()),{dragCrosshairLayer:s,outlineLayer:i,guideLayer:n,backgroundGuideLayer:t,rasterLayer:r}}),h(p,"showGuideLayers",e=>{const t=e.backgroundGuideLayer,s=e.dragCrosshairLayer,i=e.outlineLayer,n=e.guideLayer,r=e.rasterLayer;r&&!r.index&&(a.project.addLayer(r),r.sendToBack()),t.index||(a.project.addLayer(t),t.sendToBack()),s.index||(a.project.addLayer(s),s.bringToFront()),i.index||(a.project.addLayer(i),i.bringToFront()),n.index||(a.project.addLayer(n),n.bringToFront()),a.project.activeLayer,p.getPaintingLayer()}),h(p,"convertBackgroundGuideLayer",e=>{p.convertLayer(p.getBackgroundGuideLayer(),e)}),h(p,"clearRaster",()=>{const e=p.getRasterLayer();e.removeChildren();const t=new a.Raster(p.createCanvas());return t.canvas.getContext("2d").imageSmoothingEnabled=!1,t.parent=e,t.guide=!0,t.locked=!0,t.position=D,t}),h(p,"getRaster",()=>{const e=p.getRasterLayer();return e.children.length===0?p.clearRaster():e.children[0]}),h(p,"getGuideLayer",()=>{let e=p.getLayer("isGuideLayer");return e||(e=p.makeGuideLayer(),p.getPaintingLayer().activate()),e}),h(p,"setGuideItem",e=>{if(e.locked=!0,e.guide=!0,z.isGroupItem(e))for(let t=0;t<e.children.length;t++)p.setGuideItem(e.children[t])}),h(p,"setupLayers",e=>{p.makeRasterLayer();const t=p.makeBackgroundGuideLayer(e),s=p.makePaintingLayer(),i=p.makeDragCrosshairLayer(),n=p.makeOutlineLayer(),r=p.makeGuideLayer();t.sendToBack(),i.bringToFront(),n.bringToFront(),r.bringToFront(),s.activate()}),h(p,"getRasterLayer",()=>p.getLayer("isRasterLayer")),h(p,"getBackgroundGuideLayer",()=>p.getLayer("isBackgroundGuideLayer")),h(p,"getDragCrosshairLayer",()=>p.getLayer("isDragCrosshairLayer")),h(p,"getOutlineLayer",()=>p.getLayer("isOutlineLayer")),h(p,"getPaintingLayer",()=>p.getLayer("isPaintingLayer")),h(p,"getLayer",e=>{for(const t of a.project.layers)if(t.data&&t.data[e])return t}),h(p,"convertLayer",(e,t)=>{e.bitmapBackground.visible=Hs(t),e.vectorBackground.visible=Yt(t)}),h(p,"makeGuideLayer",()=>{const e=new a.Layer;return e.data.isGuideLayer=!0,e}),h(p,"makePaintingLayer",()=>{const e=new a.Layer;return e.data.isPaintingLayer=!0,e}),h(p,"makeRasterLayer",()=>{const e=new a.Layer;return e.data.isRasterLayer=!0,p.clearRaster(),e}),h(p,"makeBackgroundGuideLayer",e=>{const t=new a.Layer;t.data.isBackgroundGuideLayer=!0,t.locked=!0;const s=new a.Shape.Rectangle(dt);s.fillColor=new a.Color("#ede7f6"),s.position=D;const i=p.makeBackgroundPaper(dt.width/p.CHECKERBOARD_SIZE,dt.height/p.CHECKERBOARD_SIZE+1,"#d1c4e9",.55);i.position=D,i.scaling=new a.Point(p.CHECKERBOARD_SIZE,p.CHECKERBOARD_SIZE);const n=new a.Group;n.addChild(s),n.addChild(i),p.setGuideItem(n),t.vectorBackground=n;const r=p.makeBackgroundPaper(wt/p.CHECKERBOARD_SIZE,Ct/p.CHECKERBOARD_SIZE,"#d1c4e9",.55);return r.position=D,r.scaling=new a.Point(p.CHECKERBOARD_SIZE,p.CHECKERBOARD_SIZE),r.guide=!0,r.locked=!0,t.bitmapBackground=r,p.convertLayer(t,e),p.makeCrosshair(.16,t),t}),h(p,"makeOutlineLayer",()=>{const e=new a.Layer,t=new a.Shape.Rectangle(bt.expand(1));t.strokeWidth=2,t.strokeColor=new a.Color("white"),p.setGuideItem(t);const s=new a.Shape.Rectangle(bt.expand(5));return s.strokeWidth=2,s.strokeColor=new a.Color("#311b92"),s.opacity=.25,p.setGuideItem(s),e.data.isOutlineLayer=!0,e}),h(p,"makeDragCrosshairLayer",()=>{const e=new a.Layer;return p.makeCrosshair(p.CROSSHAIR_FULL_OPACITY,e),e.data.isDragCrosshairLayer=!0,e.visible=!1,e}),h(p,"makeCrosshair",(e,t)=>{const s=new a.Group,i=new a.Path.Line(new a.Point(0,-7),new a.Point(0,7));i.strokeWidth=6,i.strokeColor="white",i.strokeCap="round",s.addChild(i);const n=new a.Path.Line(new a.Point(-7,0),new a.Point(7,0));n.strokeWidth=6,n.strokeColor="white",n.strokeCap="round",s.addChild(n);const r=new a.Shape.Circle(new a.Point(0,0),5.5);r.strokeWidth=6,r.strokeColor="white",s.addChild(r);const l=new a.Path.Line(new a.Point(0,-7),new a.Point(0,7));l.strokeWidth=2,l.strokeColor="black",l.strokeCap="round",s.addChild(l);const u=new a.Path.Line(new a.Point(-7,0),new a.Point(7,0));u.strokeWidth=2,u.strokeColor="black",u.strokeCap="round",s.addChild(u);const c=new a.Shape.Circle(new a.Point(0,0),5.5);c.strokeWidth=2,c.strokeColor="black",s.addChild(c),p.setGuideItem(s),s.position=D,s.opacity=e,s.parent=t,s.applyMatrix=!1,t.dragCrosshair=s,s.scale(p.CROSSHAIR_SIZE/s.bounds.width/a.view.zoom)}),h(p,"makeBackgroundPaper",(e,t,s,i)=>{let n=0,r=0;const l=[];for(;n<e;)l.push(new a.Point(n,r)),n++,l.push(new a.Point(n,r)),r=r===0?t:0;for(r=t-1,n=e;r>0;)l.push(new a.Point(n,r)),n=n===0?e:0,l.push(new a.Point(n,r)),r--;const u=new a.Shape.Rectangle(new a.Point(0,0),new a.Point(wt/p.CHECKERBOARD_SIZE,Ct/p.CHECKERBOARD_SIZE));u.fillColor=new a.Color("#fff"),u.guide=!0,u.locked=!0,u.position=D;const c=new a.Path(l);c.fillRule="evenodd",c.fillColor=new a.Color(s),c.opacity=i,c.guide=!0,c.locked=!0,c.position=D;const f=new a.Shape.Rectangle(dt);f.position=D,f.guide=!0,f.locked=!0,f.scale(1/p.CHECKERBOARD_SIZE);const g=new a.Group([u,c,f]);return f.clipMask=!0,g});let S=p;const Us=function(o){return o&&o.className==="CompoundPath"},be=function(o){return o.parent?o.parent.className==="CompoundPath":!1},Fs=function(o){const e=o.parent;return Us(e)?e:null};class bi{constructor(){h(this,"groupItems",e=>{if(e.length>0){const t=new a.Group(e);b.clearSelection(),b.setItemSelection(t,!0);for(let s=0;s<t.children.length;s++)t.children[s].selected=!0;return t}});h(this,"groupSelection",()=>{const e=b.getSelectedRootItems();return this.groupItems(e)});h(this,"ungroupItems",(e,t=!1)=>{if(e.length===0)return;const s=[];for(let i=0;i<e.length;i++){const n=e[i];z.isGroupItem(n)&&!n.data.isPGTextItem?(this.ungroupLoop(n,!1,t),n.hasChildren()||s.push(n)):t&&(n.selected=!0)}for(let i=0;i<s.length;i++)s[i].remove()});h(this,"ungroupSelection",()=>{const e=b.getSelectedRootItems();b.clearSelection(),this.ungroupItems(e,!0)});h(this,"getItemsGroup",e=>{const t=e.parent;return z.isGroupItem(t)?t:null});h(this,"isGroupChild",e=>{const t=z.getRootItem(e);return z.isGroupItem(t)});h(this,"shouldShowGroup",()=>b.getSelectedRootItems().length>1);h(this,"shouldShowUngroup",()=>{const e=b.getSelectedRootItems();for(let t=0;t<e.length;t++){const s=e[t];if(z.isGroupItem(s)&&!s.data.isPGTextItem&&s.children&&s.children.length>0)return!0}return!1});h(this,"ungroupLoop",(e,t,s=!1)=>{if(!(!e||!e.children||!z.isGroupItem(e))){e.applyMatrix=!0;for(let i=0;i<e.children.length;i++){let n=e.children[i];if(n instanceof a.Group&&n.hasChildren()){if(t){this.ungroupLoop(n,t,s);continue}n.children.length===1&&(n=n.reduce())}n.applyMatrix=!0,n.insertBelow(e),s&&(n.selected=!0),i--}}})}}const se=new bi,Si=.3902628565,Ii=function(o,e,t){const s=Math.abs(o.x-e.x),i=Math.abs(o.y-e.y);return s<t&&i<t},Ns=function(o,e){return Math.floor(Math.random()*(e-o))+o},Mi=function(){return Ns(0,2)===1},yi=function(o,e){let t=Math.atan2(o.y,o.x);t=Math.round(t/e)*e;const s=Math.cos(t),i=Math.sin(t),n=s*o.x+i*o.y;return new a.Point(s*n,i*n)},Ze=function(o){let e=o,t=0;for(;!(e instanceof a.Layer);){if(t++,e.parent===null)return null;e=e.parent}return t},Ri=function(o,e){if(o===null||e===null)return 0;let t=o,s=e,i=Ze(o),n=Ze(e);if(i!==null&&n!==null){for(;n>i;)s=s.parent,n--;for(;i>n;)t=t.parent,i--}for(;t&&s;){if(s===t)return 0;if(s.parent===t.parent)return s.parent instanceof a.CompoundPath?Math.abs(s.area)-Math.abs(t.area):Number(t.index)-Number(s.index);s=s.parent,t=t.parent}return 0},xi=function(o,e){const t=o.position;let s=o.area;for(const i of o.segments){const n=i.point.subtract(t).normalize().multiply(e);i.point=i.point.add(n),o.area<s&&(i.point=i.point.subtract(n.multiply(2))),s=o.area}},Pe=function(o,e){if(o instanceof a.Group)for(const t of o.children)Pe(t,e);else e(o)},Ti=function(o){Pe(o,e=>{e instanceof a.PathItem&&(e.clockwise=!0)})},Pi=function(o,e,t=new a.Point(0,0)){Pe(o,s=>{s instanceof a.PointText||s.strokeWidth&&(s.strokeWidth=s.strokeWidth*e)}),o.scale(e,t)},Bi=function(o,e){let t=e.x-o.x,s=e.y-o.y;t=t||1,s=s||1;const i=e.subtract(o).abs(),n=Math.max(i.x,i.y),r=new a.Point(n*t/Math.abs(t),n*s/Math.abs(s)),l=o.add(r.multiply(.5));return{size:r,position:l}};class U{}h(U,"HANDLE_RATIO",Si),h(U,"checkPointsClose",Ii),h(U,"ensureClockwise",Ti),h(U,"expandBy",xi),h(U,"getRandomInt",Ns),h(U,"getRandomBoolean",Mi),h(U,"getSquareDimensions",Bi),h(U,"scaleWithStrokes",Pi),h(U,"snapDeltaToAngle",yi),h(U,"sortItemsByZIndex",Ri);const Ei={paintFormat:ht.VECTOR,toolMode:null,cursor:et.DEFAULT,undo:{canUndo:!1,canRedo:!1},fillColor:{primary:"#673ab7",secondary:null,gradientType:O.SOLID},strokeColor:{primary:"#000000",secondary:"#ffffff",gradientType:O.RADIAL},strokeWidth:6,brushSize:10,eraserSize:40,workspaceBounds:bt,viewBounds:bt,selectedItems:null,zoomHistory:{}};class ki extends zt{constructor(){super(...arguments);h(this,"state",Ei)}setState(t){for(const s of Object.entries(t)){const[i,n]=s,r=this.state[i];r!==n&&(this.state[i]=n,this.emitAsync("change",{key:i,oldValue:r,newValue:n}))}}get fillColor(){return this.state.fillColor}get strokeColor(){return this.state.strokeColor}get strokeWidth(){return this.state.strokeWidth}get brushSize(){return this.state.brushSize}get eraserSize(){return this.state.eraserSize}get toolMode(){return this.state.toolMode}get paintFormat(){return this.state.paintFormat}get cursor(){return this.state.cursor}get workspaceBounds(){return this.state.workspaceBounds}get viewBounds(){return this.state.viewBounds}get undo(){return this.state.undo}get selectedItems(){return this.state.selectedItems}get zoomHistory(){return this.state.zoomHistory}}const B=new ki,Li=o=>{const t={...o,match:s=>!(s instanceof a.Layer)&&s.layer.data&&s.layer.data.isPaintingLayer&&!s.locked&&!s.isClipMask()&&!(s.data&&s.data.isHelperItem)&&(!o.match||o.match(s))};return a.project.getItems(t)},Gs=(o=!1)=>{const e=[];for(const t of a.project.layers)for(const s of t.children)!o&&s.guide||e.push(s);return e},Ht=()=>{const o=Gs(),e=[];for(let t=0;t<o.length;t++)o[t].data&&!o[t].data.isHelperItem&&e.push(o[t]);return e},Vs=(o,e)=>{if(o.children)for(let t=0;t<o.children.length;t++){const s=o.children[t];s.children&&s.children.length>0?Vs(s,e):s.fullySelected=e}else for(let t=0;t<o.segments.length;t++)o.segments[t].selected=e},Se=(o,e,t=!1)=>{if(o.fullySelected=t,o.selected=e,Us(o)||z.isGroupItem(o)){const s=o.children;if(s)for(const i of s)z.isGroupItem(i)?Se(i,e,t):(i.fullySelected=t,i.selected=e)}},tt=(o,e,t)=>{const s=se.getItemsGroup(o),i=Fs(o);if(s)tt(s,e,t);else if(i)Se(i,e,t);else{if(o.data&&o.data.noSelect)return;Se(o,e,t)}},Ai=()=>{const o=Ht();if(o.length===0)return!1;for(let e=0;e<o.length;e++)tt(o[e],!0);return!0},Di=()=>{const o=Ht();if(o.length===0)return!1;for(let e=0;e<o.length;e++)Vs(o[e],!0);return!0},Oi=()=>{a.project.deselectAll(),B.setState({selectedItems:null})},Be=()=>{const o=Ht(),e=[];for(const t of o)if(t.selected)e.push(t);else if(t instanceof a.CompoundPath){for(const s of t.children)if(s.selected){e.push(t);break}}return e.sort((t,s)=>t.index-s.index),e},Ut=()=>{const o=a.project.selectedItems,e=[];for(let t=0;t<o.length;t++){const s=o[t];!(s instanceof a.Layer)&&!z.isGroupItem(s)&&s.data&&!s.data.isSelectionBound&&e.push(s)}return e.sort(U.sortItemsByZIndex),e},zi=()=>{const o=Ut(),e=[];for(const t of o)if(t.segments)for(const s of t.segments)s.selected&&e.push(s);return e},Ke=o=>{if(o.length===0)return!1;for(let e=0;e<o.length;e++)o[e].remove();return!0},Hi=function(o){const e=[];for(let s=0;s<o.length;s++){if(!o[s].segments)continue;const i=o[s].segments;for(let n=0;n<i.length;n++){const r=i[n];r.selected&&e.push(r)}}let t=!1;for(let s=0;s<e.length;s++)e[s].remove(),t=!0;return t},Ui=function(o){if(o===m.RESHAPE){const t=Ut();return Hi(t)?!0:Ke(t)}const e=Be();return Ke(e)},Fi=function(o=!1){const e=o?Ut():Be();for(let t=0;t<e.length;t++){const s=e[t];s.clone(),s.selected=!1}},Ni=function(o,e,t){const s=new a.Path([e.localToGlobal(e.internalBounds.topLeft),e.localToGlobal(e.internalBounds.topRight),e.localToGlobal(e.internalBounds.bottomRight),e.localToGlobal(e.internalBounds.bottomLeft)]);s.closed=!0,s.guide=!0;for(let i=0;i<s.segments.length;i++){const n=s.segments[i];if(o.contains(n.point)||i===0&&o.getIntersections(s).length>0)return t.modifiers.shift&&e.selected?tt(e,!1):tt(e,!0),s.remove(),!0}s.remove()},Ws=function(o,e,t,s,i){if(z.isPathItem(o)){const n=o;let r=!1;for(let u=0;u<n.segments.length;u++){const c=n.segments[u];if(t.contains(c.point))if(s===m.RESHAPE)e.modifiers.shift&&c.selected?c.selected=!1:c.selected=!0,r=!0;else return e.modifiers.shift&&n.selected?tt(i,!1):tt(i,!0,!0),!1}const l=n.getIntersections(t);if(l.length>0&&!r)if(s===m.RESHAPE)for(let u=0;u<l.length;u++){const c=l[u].curve;u%2!==1&&(e.modifiers.shift?c.selected=!c.selected:c.selected=!0)}else return e.modifiers.shift&&o.selected?tt(o,!1):tt(o,!0),!1}else if(z.isBoundsItem(o)&&Ni(t,o,e))return!1;return!0},js=function(o,e,t,s,i){for(let n=0;n<o.children.length;n++){const r=o.children[n];z.isGroupItem(r)||z.isCompoundPathItem(r)?js(r,e,t,s,i):Ws(r,s,e,i,t)}return!0},Gi=function(o,e,t){const s=Ht();for(let i=0;i<s.length;i++){const n=s[i];t===m.RESHAPE&&z.isPGTextItem(z.getRootItem(n))||(z.isGroupItem(n)||z.isCompoundPathItem(n)?js(n,e,n,o,t):Ws(n,o,e,t,n))}},Vi=function(){const o=Ut();for(const e of o){if(be(e)){const s=Fs(e);tt(s,!0,!0)}const t=z.getRootItem(e);e!==t&&tt(t,!0,!0)}};class b{}h(b,"getItems",Li),h(b,"getAllRootItems",Gs),h(b,"getAllSelectableRootItems",Ht),h(b,"selectAllItems",Ai),h(b,"selectAllSegments",Di),h(b,"clearSelection",Oi),h(b,"deleteSelection",Ui),h(b,"cloneSelection",Fi),h(b,"setItemSelection",tt),h(b,"getSelectedLeafItems",Ut),h(b,"getSelectedRootItems",Be),h(b,"getSelectedSegments",zi),h(b,"processRectangularSelection",Gi),h(b,"selectRootItem",Vi);const Gt="#673ab7",Wi="#aaaaaa",q=class q{};h(q,"getGuideColor",()=>Gt),h(q,"hoverItem",e=>{const t=e.segments,s=new a.Path(t);return he(s),e.closed&&(s.closed=!0),s.parent=S.getGuideLayer(),s.position=e.position,s.strokeColor=Gt,s.fillColor=null,s.data.isHelperItem=!0,s.data.origItem=e,s.bringToFront(),s}),h(q,"hoverBounds",(e,t)=>{let s=e.internalBounds;t&&(s=s.expand(t));const i=new a.Path.Rectangle(s);return i.matrix=e.matrix,he(i),i.parent=S.getGuideLayer(),i.strokeColor=Gt,i.fillColor=null,i.data.isHelperItem=!0,i.data.origItem=e,i.bringToFront(),i}),h(q,"rectSelect",(e,t)=>{const s=new a.Point(.5/a.view.zoom,.5/a.view.zoom),i=e.downPoint.add(s),n=e.point.add(s),r=new a.Path.Rectangle(i,n),l=1/a.view.zoom;return he(r),t||(t=Wi),r.parent=S.getGuideLayer(),r.strokeColor=new a.Color(t),r.data.isRectSelect=!0,r.data.isHelperItem=!0,r.dashArray=[3*l,3*l],r}),h(q,"removeBoundsPath",()=>{ce(["isSelectionBound","isRotHandle","isScaleHandle"])}),h(q,"removeBoundsHandles",()=>{ce(["isRotHandle","isScaleHandle"])}),h(q,"removeAllGuides",()=>{ji(["guide"])}),h(q,"removeHitPoint",()=>{ce(["isHitPoint"])}),h(q,"drawHitPoint",e=>{if(q.removeHitPoint(),e){const t=new a.Path.Circle(e,4/a.view.zoom);t.strokeWidth=1/a.view.zoom,t.strokeColor=Gt,t.fillColor=new a.Color(1,1,1,.5),t.parent=S.getGuideLayer(),t.data.isHitPoint=!0,t.data.isHelperItem=!0}});let V=q;const he=o=>{o.strokeWidth=1/a.view.zoom,o.opacity=1,o.blendMode="normal",o.guide=!0},ce=o=>{const e=b.getAllRootItems(!0);for(const t of e)for(const s of o)t.data&&t.data[s]&&t.remove()},ji=o=>{const e=b.getAllRootItems(!0);for(const t of e)for(const s of o)t[s]&&t.remove()},ft=function(o,e,t){let s=~~o.x;const i=~~e.x;let n=~~o.y;const r=~~e.y,l=Math.abs(i-s),u=Math.abs(r-n),c=s<i?1:-1,f=n<r?1:-1;let g=l-u;for(t(s,n);s!==i||n!==r;){const C=g*2;C>-u&&(g-=u,s+=c),C<l&&(g+=l,n+=f),t(s,n)}},Vt=function(o,e,t){const s=(-e+Math.sqrt(e*e-4*o*t))/2/o,i=(-e-Math.sqrt(e*e-4*o*t))/2/o;return s>i?[s,i]:[i,s]},Ie=function(o,e){const t=~~o.centerX,s=~~o.centerY,i=~~Math.abs(o.radiusX)-.5,n=~~Math.abs(o.radiusY)-.5,r=o.shearSlope,l=o.isFilled,u=o.drawFn;if(r===1/0||i<1||n<1)return!1;const c=1/i/i+r*r/n/n,f=-2*r/n/n,g=1/n/n,C=(-2*c-f)/(2*g+f),w=(-(2*c)+f)/(-(2*g)+f),y=C>w,L=function(A,R){let I=A,P=Vt(c,f*I,g*I*I-1),E,k,N;for(;R(P[0],I);)E=Math.floor(I),k=Math.floor(P[0]),N=Math.floor(P[1]),l?(e.fillRect(t-k-1,s+E,k-N+1,1),e.fillRect(t+N,s-E-1,k-N+1,1)):(u(t-k-1,s+E),u(t+k,s-E-1)),I--,P=Vt(c,f*I,g*I*I-1);return k||E?{x:k,y:E}:null},x=function(A,R){let I=A,P=Vt(g,f*I,c*I*I-1),E,k,N;for(;R(I,P[0]);)E=Math.floor(I),k=Math.floor(P[0]),N=Math.floor(P[1]),l?(e.fillRect(t-E-1,s+N,1,k-N+1),e.fillRect(t+E,s-k-1,1,k-N+1)):(u(t-E-1,s+k),u(t+E,s-k-1)),I++,P=Vt(g,f*I,c*I*I-1);return E||k?{x:E,y:k}:null};let T;if(y){let A=!1;C>0&&(A=!0),T=L(A?-n:n,(R,I)=>R===0&&I>0?!0:R===0&&I<0?!1:I/R>C),T=x(T?-T.x+.5:.5,(R,I)=>I/R>w)||{x:-T.x-.5,y:-T.y-.5},L(T.y-.5,(R,I)=>A?I>-n:I>n)}else T=x(.5,(A,R)=>R/A>w),T=L(T?T.y-.5:n,(A,R)=>A===0&&R>0?!0:A===0&&R<0?!1:R/A>C)||T,x(-T.x+.5,A=>A<0);return!0},Dt=function(o,e,t=!1){o=~~o;const s=document.createElement("canvas"),i=Math.ceil(o/2);s.width=i*2,s.height=i*2;const n=s.getContext("2d");if(n.imageSmoothingEnabled=!1,n.fillStyle=t?"white":e,o<=5){let r=0;o%2&&(r=1),t?(n.fillStyle=V.getGuideColor(),n.fillRect(r,r,o,o),n.fillStyle="white",n.fillRect(r+1,r+1,o-2,o-2)):n.fillRect(r,r,o,o)}else Ie({centerX:o/2,centerY:o/2,radiusX:o/2,radiusY:o/2,shearSlope:0,isFilled:!0},n),t&&(n.fillStyle=V.getGuideColor(),Ie({centerX:o/2,centerY:o/2,radiusX:o/2,radiusY:o/2,shearSlope:0,isFilled:!1,drawFn:(r,l)=>n.fillRect(r,l,1,1)},n));return s},_i=function(o,e){const t=o.position.x,s=o.position.y,i=o.radiusX,n=o.radiusY,r=o.matrix,l=o.isFilled,u=o.thickness;let c=null;if(!r.isInvertible())return!1;const f=r.clone().invert(),g=e.fillStyle instanceof CanvasGradient;let C,w;const{width:y,height:L}=e.canvas;if(g&&(w=S.createCanvas(y,L),C=e,e=w.getContext("2d")),!l){const k=Dt(u,g?"black":e.fillStyle),N=Math.ceil(u/2);c=(_,Y)=>{e.drawImage(k,~~_-N,~~Y-N)}}const x=f.a*f.a/i/i+f.b*f.b/n/n,T=2*f.a*f.c/i/i+2*f.b*f.d/n/n,A=f.c*f.c/i/i+f.d*f.d/n/n,R=1/Math.sqrt(A),I=Math.sqrt(-4*A/(T*T-4*x*A)),P=T/2/A,E=Ie({centerX:t,centerY:s,radiusX:I,radiusY:R,shearSlope:P,isFilled:l,drawFn:c},e);return g&&E&&(e.globalCompositeOperation="source-in",e.fillStyle=C.fillStyle,e.fillRect(0,0,y,L),C.drawImage(w,0,0)),E},$e=function(o,e,t){for(let s=0;s<e;++s)if(o.data[(t*e<<2)+(s<<2)+3]!==0)return!1;return!0},qe=function(o,e,t,s,i){for(let n=s;n<i;++n)if(o.data[(n*e<<2)+(t<<2)+3]!==0)return!1;return!0},oe=function(o,e){const t=e||o.bounds,s=t.width,i=o.getImageData(t);let n=0,r=i.height,l=0,u=i.width;for(;n<r&&$e(i,s,n);)++n;for(;r-1>n&&$e(i,s,r-1);)--r;for(;l<u&&qe(i,s,l,n,r);)++l;for(;u-1>l&&qe(i,s,u-1,n,r);)--u;return n===r&&(n=r=i.height/2),l===u&&(l=u=i.width/2),new a.Rectangle(l+t.left,n+t.top,u-l,r-n)},_s=function(o,e,t){return t.getImageData(o,e,1,1).data},Et=function(o,e,t,s){const i=(e*t.width+o)*4;return t.data[i+0]===s[0]&&t.data[i+1]===s[1]&&t.data[i+2]===s[2]&&t.data[i+3]===s[3]},Me=function(o,e,t,s){const i=(e*t.width+o)*4;t.data[i+0]=s[0],t.data[i+1]=s[1],t.data[i+2]=s[2],t.data[i+3]=s[3]},Xi=function(o,e,t,s,i,n,r){for(;e>0&&Et(o,e-1,t,n);)e--;let l=!1,u=!1;for(;e<t.height&&Et(o,e,t,n);e++)Me(o,e,t,i),Me(o,e,s,i),o>0&&(Et(o-1,e,t,n)?l||(r.push([o-1,e]),l=!0):l=!1),o<t.width-1&&(Et(o+1,e,t,n)?u||(r.push([o+1,e]),u=!0):u=!1)},Xs=function(o){const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");return t.fillStyle=o,t.fillRect(0,0,1,1),t.getImageData(0,0,1,1).data},Yi=function(o,e,t,s,i){o=~~o,e=~~e;const n=Xs(t),r=_s(o,e,s),l=s.getImageData(0,0,s.canvas.width,s.canvas.height);let u=l;if(i!==s&&(u=new ImageData(s.canvas.width,s.canvas.height)),r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3])return!1;const c=[[o,e]];for(;c.length;){const f=c.pop();Xi(f[0],f[1],l,u,n,r,c)}return i.putImageData(u,0,0),!0},Zi=function(o,e,t,s,i){o=~~o,e=~~e;const n=Xs(t),r=_s(o,e,s),l=s.getImageData(0,0,s.canvas.width,s.canvas.height);let u=l;if(i!==s&&(u=new ImageData(s.canvas.width,s.canvas.height)),r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3])return!1;for(let c=0;c<l.width;c++)for(let f=0;f<l.height;f++)Et(c,f,l,r)&&Me(c,f,u,n);return i.putImageData(u,0,0),!0},Ys=function(o,e){if(o.matrix.b===0&&o.matrix.c===0){const c=o.size.width*o.matrix.a,f=o.size.height*o.matrix.d;e.fillRect(Math.round(o.matrix.tx-c/2),Math.round(o.matrix.ty-f/2),Math.round(c),Math.round(f));return}const t=o.matrix.transform(new a.Point(-o.size.width/2,-o.size.height/2)),s=o.matrix.transform(new a.Point(o.size.width/2,-o.size.height/2)),i=o.matrix.transform(new a.Point(-o.size.width/2,o.size.height/2)),n=o.matrix.transform(new a.Point(o.size.width/2,o.size.height/2)),r=o.matrix.transform(new a.Point),l=[t,s,i,n].sort((c,f)=>c.x-f.x),u=(c,f,g)=>f.x===c.x?r.x>c.x?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:(f.y-c.y)/(f.x-c.x)*(g-c.x)+c.y;for(let c=Math.round(l[0].x);c<Math.round(l[3].x);c++){const f=[u(t,s,c+.5),u(t,i,c+.5),u(n,s,c+.5),u(n,i,c+.5)].sort((g,C)=>g-C);e.fillRect(c,Math.round(f[1]),1,Math.max(1,Math.round(f[2])-Math.round(f[1])))}},Ki=function(o,e,t){const s=Dt(e,t.fillStyle),i=Math.ceil(e/2),n=(L,x)=>{t.drawImage(s,~~L-i,~~x-i)},r=t.fillStyle instanceof CanvasGradient;let l,u;const{width:c,height:f}=t.canvas;r&&(u=S.createCanvas(c,f),l=t,t=u.getContext("2d"));const g=o.matrix.transform(new a.Point(-o.size.width/2,-o.size.height/2)),C=o.matrix.transform(new a.Point(o.size.width/2,-o.size.height/2)),w=o.matrix.transform(new a.Point(-o.size.width/2,o.size.height/2)),y=o.matrix.transform(new a.Point(o.size.width/2,o.size.height/2));ft(g,C,n),ft(g,w,n),ft(y,C,n),ft(y,w,n),r&&(t.globalCompositeOperation="source-in",t.fillStyle=l.fillStyle,t.fillRect(0,0,c,f),l.drawImage(u,0,0))},$i=function(o){const e=S.createCanvas(o.width,o.height),t=e.getContext("2d");return t.save(),t.scale(-1,1),t.drawImage(o,0,0,-e.width,e.height),t.restore(),e},qi=function(o){const e=S.createCanvas(o.width,o.height),t=e.getContext("2d");return t.save(),t.scale(1,-1),t.drawImage(o,0,0,e.width,-e.height),t.restore(),e},Je=function(o,e){let t=S.createCanvas(Math.round(o.width*Math.abs(e.x)),o.height);return e.x<0&&(o=$i(o)),t.getContext("2d").drawImage(o,0,0,t.width,t.height),o=t,t=S.createCanvas(o.width,Math.round(o.height*Math.abs(e.y))),e.y<0&&(o=qi(o)),t.getContext("2d").drawImage(o,0,0,t.width,t.height),t},Ji=function(o){const e=o.matrix.decompose();Math.abs(e.scaling.x)<1&&Math.abs(e.scaling.y)<1&&e.scaling.x!==0&&e.scaling.y!==0&&(o.canvas=Je(o.canvas,e.scaling),o.data&&o.data.expanded&&(o.data.expanded.canvas=Je(o.data.expanded.canvas,e.scaling)),o.matrix.append(new a.Matrix().scale(new a.Point(1/e.scaling.x,1/e.scaling.y))))},Qi=function(o,e){const t=S.createCanvas(),s=t.getContext("2d"),i=new a.Shape.Rectangle(new a.Point,o.size);i.matrix=o.matrix,Ys(i,s),i.remove(),s.globalCompositeOperation="source-in";const n=o.matrix;s.transform(n.a,n.b,n.c,n.d,n.tx,n.ty);let r=o.canvas;o.data&&o.data.expanded&&(r=o.data.expanded.canvas),s.transform(1,0,0,1,-r.width/2,-r.height/2),s.drawImage(r,0,0),e.drawImage(t,new a.Point)},Zs=function(o,e){o.matrix.isInvertible()&&(Ji(o),Qi(o,e))},Ks=function(o,e){if(!o)return null;if(o.type==="gradient"){let t;const{origin:s,destination:i}=o;if(o.gradient.radial){let{highlight:r}=o;const l=r||s,u=i.getDistance(s);if(r){const c=r.subtract(s);c.getLength()>u&&(r=s.add(c.normalize(u-.1)))}t=e.createRadialGradient(l.x,l.y,0,s.x,s.y,u)}else t=e.createLinearGradient(s.x,s.y,i.x,i.y);const{stops:n}=o.gradient;for(let r=0,l=n.length;r<l;r++){const u=n[r],c=u.offset;t.addColorStop(c||r/(l-1),u.color.toCSS())}return t}return o.toCSS()},$s=function(o,e){const t=Math.abs(o.size.width/2),s=Math.abs(o.size.height/2),i=e.getContext("2d"),n=o.strokeWidth===0,r=Ks(n?o.fillColor:o.strokeColor,i);return r?(i.fillStyle=r,_i({position:o.position,radiusX:t,radiusY:s,matrix:o.matrix,isFilled:n,thickness:o.strokeWidth/a.view.zoom},i)):void 0},qs=function(o,e){const t=S.createCanvas(),s=t.getContext("2d"),i=o.strokeWidth===0,n=Ks(i?o.fillColor:o.strokeColor,s);n&&(s.fillStyle=n,i?Ys(o,s):Ki(o,o.strokeWidth/a.view.zoom,s),e.drawImage(t,new a.Point))},Qe=.5;class tn extends zt{constructor(){super(...arguments);h(this,"updateWorkspaceBounds",t=>{const s=b.getAllRootItems();let i=bt;t||(i=i.unite(a.view.bounds));for(const g of s)i=i.unite(g.bounds.expand(re));i=i.intersect(dt.expand(re));let n=i.top,r=i.left,l=i.bottom,u=i.right,c=0,f=0;i.width<a.view.bounds.width&&(c=(a.view.bounds.width-i.width)/2,r-=c,u+=c),i.height<a.view.bounds.height&&(f=(a.view.bounds.height-i.height)/2,n-=f,l+=f),B.setState({workspaceBounds:new a.Rectangle(r,n,u-r,l-n)})});h(this,"clampViewBounds",()=>{const{left:t,right:s,top:i,bottom:n}=a.project.view.bounds;t<B.workspaceBounds.left&&a.project.view.translate(new a.Point(t-B.workspaceBounds.left,0)),i<B.workspaceBounds.top&&a.project.view.translate(new a.Point(0,i-B.workspaceBounds.top)),n>B.workspaceBounds.bottom&&a.project.view.translate(new a.Point(0,n-B.workspaceBounds.bottom)),s>B.workspaceBounds.right&&a.project.view.translate(new a.Point(s-B.workspaceBounds.right,0)),this.updateWorkspaceBounds()});h(this,"resizeCrosshair",()=>{var i,n;const t=(i=S.getDragCrosshairLayer())==null?void 0:i.dragCrosshair;t&&t.scale(S.CROSSHAIR_SIZE/t.bounds.width/a.view.zoom);const s=(n=S.getBackgroundGuideLayer())==null?void 0:n.dragCrosshair;s&&s.scale(S.CROSSHAIR_SIZE/s.bounds.width/a.view.zoom)});h(this,"getActionBounds",t=>t?bt:a.view.bounds.unite(bt).intersect(dt));h(this,"zoomOnSelection",t=>{let s;const i=b.getSelectedRootItems();if(i.length>0){let n=null;for(const r of i)n?n=n.unite(r.bounds):n=r.bounds;s=n.center}else s=a.project.view.center;this.zoomOnFixedPoint(t,s)});h(this,"resetZoom",()=>{a.project.view.zoom=.5,this.updateWorkspaceBounds(!0),this.clampViewBounds(),this.resizeCrosshair()});h(this,"zoomIn",()=>{let t=Qe;a.view.zoom===ae&&(t=.5-ae),this.zoomOnSelection(t)});h(this,"zoomOut",()=>{this.zoomOnSelection(-Qe)});h(this,"zoomToFit",t=>{this.resetZoom();let s;if(t)s=oe(S.getRaster()).expand(re);else{const i=b.getAllRootItems();for(const n of i)s?s=s.unite(n.bounds):s=n.bounds}if(s&&s.width&&s.height){const i=a.view.element;let n=a.view.zoom*Math.max(s.width*(1+2*ze/100)/i.clientWidth,s.height*(1+2*ze/100)/i.clientHeight);n=Math.max(Math.min(1,n),No),n<1&&(a.view.center=s.center,a.view.zoom=a.view.zoom/n,this.resizeCrosshair(),this.clampViewBounds())}});h(this,"zoomToFitMaybe",(t,s)=>{const i=B.zoomHistory[t];i?(a.view.matrix.set(i),this.updateWorkspaceBounds(!0),this.resizeCrosshair()):this.zoomToFit(s)});h(this,"recordZoom",t=>{a.view&&B.setState({zoomHistory:{...B.zoomHistory,[t]:a.view.matrix.clone()}})});h(this,"zoomOnFixedPoint",(t,s)=>{const i=a.view,n=i.center,r=Math.max(ae,i.zoom+t),l=i.zoom/r,u=s.subtract(n),c=s.subtract(u.multiply(l)).subtract(n);i.zoom=r,i.translate(c.multiply(-1)),this.updateWorkspaceBounds(!0),this.clampViewBounds(),this.resizeCrosshair()})}async recalibrateSize(){if(await oi(0),!a.view)return;const t=a.DomElement.getSize(a.view.element);t.width=Math.round(t.width),t.height=Math.round(t.height),a.view.setViewSize(t)}setTx(t){a.project.view.matrix.tx=t}setTy(t){a.project.view.matrix.ty=t}viewToProject(t,s){return a.project.view.viewToProject(new a.Point(t,s))}getZoom(){return a.view?a.view.zoom:1}}const Q=new tn;class Js{static async importImage(e,t,s){const i=S.getRaster(),n=new a.Shape.Rectangle(i.bounds);n.guide=!0,n.locked=!0,n.position=D,n.clipMask=!0,s||(s=[e.width/2,e.height/2]),s=s.map(u=>u*t);const[r,l]=s;i.drawImage(e,new a.Point(wt/2-r,Ct/2-l)),await Q.recalibrateSize()}}h(Js,"exportImage",async(e=2)=>{if(!S.getRaster().loaded)return;const t=S.getRaster(),s=t.getSubRaster(t.bounds);s.remove();const i=b.getSelectedLeafItems();if(i.length===1){const c=i[0];if(c instanceof a.Raster){if(!c.loaded||c.data&&c.data.expanded&&!c.data.expanded.loaded)return;Zs(c,s)}else if(c instanceof a.Shape&&c.type==="rectangle")qs(c,s);else if(c instanceof a.Shape&&c.type==="ellipse")$s(c,s);else if(c instanceof a.PointText){const f=c.drawnBounds,g=c.rasterize(72,!1,f);s.drawImage(g.canvas,new a.Point(Math.floor(f.x),Math.floor(f.y)))}}const n=oe(s);(n.width===0||n.height===0)&&(n.width=n.height=1);const r=s.getImageData(n),l=await createImageBitmap(r);let u=[wt/2-n.x,Ct/2-n.y];return u=u.map(c=>c/e),{imageBitmap:l,rotationCenter:u}});const Wt=o=>{if(o instanceof a.Rectangle)return{x:o.x,y:o.y,width:o.width,height:o.height};throw new Error("itemToJSON: unknown item type")},en=100;class sn extends zt{constructor(){super(...arguments);h(this,"stack",[]);h(this,"head",-1);h(this,"snapshot",t=>{const s=S.hideGuideLayers(),i={json:a.project.exportJSON({asString:!1}),format:t};S.showGuideLayers(s),this.head>=en-1?this.stack=this.stack.slice(1).concat(i):(this.stack=this.stack.slice(0,this.head+1).concat(i),this.head+=1),B.setState({undo:{canUndo:this.canUndo(),canRedo:this.canRedo()}})});h(this,"undo",()=>{if(this.head<0)return;this.head-=1;const{json:t,format:s}=this.stack[this.head];ts(t,s),B.setState({undo:{canUndo:this.canUndo(),canRedo:this.canRedo()}})});h(this,"redo",()=>{if(this.head<0||this.head===this.stack.length-1)return;this.head+=1;const{json:t,format:s}=this.stack[this.head];ts(t,s),B.setState({undo:{canUndo:this.canUndo(),canRedo:this.canRedo()}})});h(this,"clear",()=>{this.stack=[],this.head=-1,B.setState({undo:{canUndo:this.canUndo(),canRedo:this.canRedo()}})});h(this,"canUndo",()=>this.head>0);h(this,"canRedo",()=>this.head<this.stack.length-1)}}const ts=function(o,e){const t=Hs(e);for(let n=a.project.layers.length-1;n>=0;n--){const r=a.project.layers[n];!r.data.isBackgroundGuideLayer&&!r.data.isDragCrosshairLayer&&!r.data.isOutlineLayer&&(r.removeChildren(),r.remove())}a.project.importJSON(o);const s=[],i=()=>{if(S.getRaster().loaded){for(const n of s)if(!n.loaded)return}};if(t){const n=b.getSelectedLeafItems();n.length===1&&n[0]instanceof a.Raster&&(s.push(n[0]),n[0].data&&n[0].data.expanded instanceof a.Raster&&s.push(n[0].data.expanded))}S.getRaster().onLoad=i;for(const n of s)n.onLoad=i,n.loaded&&n.onLoad()},ye=new sn,xt=class xt{};h(xt,"importImage",async(e,t=[])=>{e=on(e);const s=a.project.importSVG(e,{expandShapes:!0});s.remove(),await Q.recalibrateSize(),xt.initializeSvg(s,nn(e),t),ye.snapshot(ht.VECTOR)}),h(xt,"exportImage",()=>{let e;if(a.project.activeLayer.clipped){for(const l of a.project.activeLayer.children)if(l.isClipMask()){e=l,e.remove();break}a.project.activeLayer.clipped=!1}const t=S.hideGuideLayers(!0);U.scaleWithStrokes(a.project.activeLayer,.5);const s=a.project.activeLayer.bounds,i=s.width===0?0:Go/2-s.x,n=s.height===0?0:Vo/2-s.y,r=a.project.exportSVG({asString:!0,bounds:"content",matrix:new a.Matrix().translate(-s.x,-s.y)});return U.scaleWithStrokes(a.project.activeLayer,2),a.project.activeLayer.applyMatrix=!0,S.showGuideLayers(t),e&&(a.project.activeLayer.addChild(e),e.clipMask=!0),{svg:r,rotationCenter:[i,n]}}),h(xt,"initializeSvg",(e,t,s=[])=>{const i=e.bounds.width,n=e.bounds.height,r=rn(e);a.project.activeLayer.addChild(r),r.clipMask=!0,e instanceof a.Group&&e.children.length===1&&(e=e.reduce()),U.ensureClockwise(e),U.scaleWithStrokes(e,2);const[l,u]=s;if(_e(l)&&_e(u)){let c=new a.Point(l,u);t&&t.length>=2&&!isNaN(t[0])&&!isNaN(t[1])&&(c=c.subtract(t[0],t[1])),e.translate(D.subtract(c.multiply(2)))}else e.translate(D.subtract(i,n));if(a.project.activeLayer.insertChild(0,e),z.isGroupItem(e)){for(const c of e.children)z.isGroupItem(c)&&c.children.length===0&&c.remove();se.ungroupItems([e])}});let Re=xt;const on=o=>{o=o.split(/<\s*svg:/).join("<"),o=o.split(/<\/\s*svg:/).join("</");const e=o.match(/<svg [^>]*>/);return e&&e[0].indexOf("xmlns=")===-1&&(o=o.replace("<svg ",'<svg xmlns="http://www.w3.org/2000/svg" ')),o},nn=o=>{var i,n;return(n=(i=new DOMParser().parseFromString(o,"text/xml").documentElement.attributes.getNamedItem("viewBox"))==null?void 0:i.value.match(/-?\d+(\.\d+)?/g))==null?void 0:n.map(r=>parseFloat(r))},rn=o=>{let e;return o.clipped?(e=o.children.find(t=>t.isClipMask()),e.clipMask=!1):e=new a.Shape.Rectangle(o.bounds),e.guide=!0,e.locked=!0,e.matrix=new a.Matrix,e.size.height=dt.height,e.size.width=dt.width,e.setPosition(D),e};class $ extends a.Tool{constructor(){super();h(this,"active",!1);h(this,"store",B);h(this,"onSelectionChanged");h(this,"childTools",[]);h(this,"onStoreChange",({key:t,newValue:s})=>{t==="selectedItems"&&(this.onSelectionChanged&&this.onSelectionChanged(s),this.childTools.forEach(i=>{i.onSelectionChanged&&i.onSelectionChanged(s)}))});h(this,"setCursor",t=>{B.setState({cursor:t})});h(this,"onImageUpdate",()=>{this.emit("Image")});h(this,"onSwitchToTextTool",()=>{this.emit("SwitchToTextTool")});B.on("change",this.onStoreChange)}get fillColor(){return this.store.fillColor}get strokeColor(){return this.store.strokeColor}get strokeWidth(){return this.store.strokeWidth}get brushSize(){return this.store.brushSize}get eraserSize(){return this.store.eraserSize}deactivate(){B.off("change",this.onStoreChange)}setSelectedItems(){B.setState({selectedItems:b.getSelectedLeafItems()})}}class es extends ${constructor(t=!1){super();h(this,"isEraser");h(this,"lastPoint");h(this,"cursorPreview");h(this,"tmpCanvas");h(this,"lastSize");h(this,"lastColor");this.isEraser=t,this.lastPoint=null,this.cursorPreview=null,this.tmpCanvas=null,this.lastSize=null,this.lastColor=null,this.onMouseMove=this.handleMouseMove,this.onMouseDown=this.handleMouseDown,this.onMouseDrag=this.handleMouseDrag,this.onMouseUp=this.handleMouseUp,this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag),this.on("mouseup",this.handleMouseUp),this.on("mousemove",this.handleMouseMove),this.updateTmpCanvas()}get color(){var t;return((t=this.fillColor)==null?void 0:t.primary)??"#000000"}get size(){const t=this.isEraser?this.eraserSize:this.brushSize;return Math.max(1,~~t)}updateTmpCanvas(){this.tmpCanvas=Dt(this.size,this.color,this.isEraser||!this.color)}draw(t,s){const i=Math.ceil(this.size/2),n=S.getRaster().getContext("2d");(this.isEraser||!this.color)&&(n.globalCompositeOperation="destination-out"),S.getRaster().drawImage(this.tmpCanvas,new a.Point(~~t-i,~~s-i)),(this.isEraser||!this.color)&&(n.globalCompositeOperation="source-over")}updateCursorIfNeeded(){this.size&&(this.cursorPreview&&!this.cursorPreview.parent&&(this.cursorPreview=null),(!this.cursorPreview||!(this.lastSize===this.size&&this.lastColor===this.color))&&(this.cursorPreview&&this.cursorPreview.remove(),this.updateTmpCanvas(),this.cursorPreview=new a.Raster(this.tmpCanvas),this.cursorPreview.guide=!0,this.cursorPreview.parent=S.getGuideLayer(),this.cursorPreview.data.isHelperItem=!0),this.lastSize=this.size,this.lastColor=this.color)}handleMouseMove(t){this.updateCursorIfNeeded(),this.cursorPreview.position=new a.Point(~~t.point.x,~~t.point.y)}handleMouseDown(t){t.event.button>0||(this.active=!0,this.cursorPreview&&this.cursorPreview.remove(),this.draw(t.point.x,t.point.y),this.lastPoint=t.point)}handleMouseDrag(t){t.event.button>0||!this.active||(ft(this.lastPoint,t.point,this.draw.bind(this)),this.lastPoint=t.point)}handleMouseUp(t){t.event.button>0||!this.active||(ft(this.lastPoint,t.point,this.draw.bind(this)),this.lastPoint=null,this.active=!1,this.updateCursorIfNeeded(),this.cursorPreview.position=new a.Point(~~t.point.x,~~t.point.y),this.onImageUpdate())}deactivate(){this.active=!1,this.tmpCanvas=null,this.cursorPreview&&(this.cursorPreview.remove(),this.cursorPreview=null)}}const ss=function(o){const e=new a.Color(o);return e.alpha=0,e.toCSS(!1)},Ee=function(o,e,t,s,i,n){if(t===O.SOLID)return o;o===null&&(o=ss(e)),e===null&&(e=ss(o)),n||(n=.01);let r,l;switch(t){case O.HORIZONTAL:{r=s.leftCenter.clone(),l=s.rightCenter.clone();const u=Math.abs(l.x-r.x);if(u<n){const c=(n-u)/2;l.x+=c,r.x-=c}break}case O.VERTICAL:{r=s.topCenter.clone(),l=s.bottomCenter.clone();const u=Math.abs(l.y-r.y);if(u<n){const c=(n-u)/2;l.y+=c,r.y-=c}break}case O.RADIAL:{const u=Math.max(s.width,s.height)/2;r=i||s.center,l=r.add(new a.Point(Math.max(u,n/2),0));break}}return{gradient:{stops:[o,e],radial:t===O.RADIAL},origin:r,destination:l}},at=function(o,e){for(const t of["fillColor","strokeColor"]){const s=e[t];if(s===null)o[t]=null;else if(s.gradientType===O.SOLID)o[t]=s.primary;else{const{primary:i,secondary:n,gradientType:r}=s;o[t]=Ee(i,n,r,o.bounds,null,e.strokeWidth)}}e.strokeWidth!==void 0&&(o.strokeWidth=e.strokeWidth)},ue="rgba(0,0,0,0)";class an extends ${get color(){var e;return((e=this.store.fillColor)==null?void 0:e.primary)??ue}get color2(){var e;return((e=this.store.fillColor)==null?void 0:e.secondary)??ue}get gradientType(){var e;return((e=this.store.fillColor)==null?void 0:e.gradientType)||O.SOLID}constructor(){super(),this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag)}handleMouseDown(e){this.paint(e)}handleMouseDrag(e){this.paint(e)}paint(e){const t=S.getRaster().getContext("2d");let s=t,i=this.color;this.gradientType!==O.SOLID?(s=S.createCanvas().getContext("2d"),i="black"):i||(i=ue);let n=!1;if(e.event.shiftKey?n=Zi(e.point.x,e.point.y,i,t,s):n=Yi(e.point.x,e.point.y,i,t,s),n&&this.gradientType!==O.SOLID){const r=new a.Raster({insert:!1});r.canvas=s.canvas,r.onLoad=()=>{r.position=S.getRaster().position,S.getRaster().getContext().globalCompositeOperation="destination-out",S.getRaster().drawImage(r.canvas,new a.Point),S.getRaster().getContext().globalCompositeOperation="source-over";const l=oe(r);if(!l.area)return;const u=new a.Shape.Rectangle({insert:!1,rectangle:{topLeft:l.topLeft,bottomRight:l.bottomRight}});u.fillColor=Ee(this.color,this.color2,this.gradientType,u.bounds,e.point);const c=u.rasterize(S.getRaster().resolution.width,!1);r.getContext().globalCompositeOperation="source-in",r.drawImage(c.canvas,c.bounds.topLeft),S.getRaster().drawImage(r.canvas,new a.Point),this.emit("Image"),this.onImageUpdate()}}else n&&this.onImageUpdate()}deactivate(){}}class ln extends ${constructor(){super();h(this,"startPoint",null);h(this,"cursorPreview",null);h(this,"drawTarget",null);h(this,"tmpCanvas",null);h(this,"lastSize",null);h(this,"lastColor",null);this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag),this.on("mouseup",this.handleMouseUp),this.on("mousemove",this.handleMouseMove),this.tmpCanvas=Dt(this.size,this.color)}get size(){return Math.max(1,~~this.store.brushSize)}get color(){var t;return((t=this.store.fillColor)==null?void 0:t.primary)||"black"}draw(t,s){const i=Math.ceil(this.size/2);this.drawTarget.drawImage(this.tmpCanvas,new a.Point(~~t-i,~~s-i))}updateCursorIfNeeded(){this.size&&(this.cursorPreview&&!this.cursorPreview.parent&&(this.cursorPreview=null),(!this.cursorPreview||!(this.lastSize===this.size&&this.lastColor===this.color))&&(this.cursorPreview&&this.cursorPreview.remove(),this.tmpCanvas=Dt(this.size,this.color),this.cursorPreview=new a.Raster(this.tmpCanvas),this.cursorPreview.guide=!0,this.cursorPreview.parent=S.getGuideLayer(),this.cursorPreview.data.isHelperItem=!0),this.lastSize=this.size,this.lastColor=this.color)}handleMouseMove(t){this.updateCursorIfNeeded(),this.cursorPreview.position=new a.Point(~~t.point.x,~~t.point.y)}handleMouseDown(t){if(t.event.button>0)return;this.active=!0,this.cursorPreview&&this.cursorPreview.remove();const s=S.createCanvas();this.drawTarget=new a.Raster(s),this.drawTarget.parent=S.getGuideLayer(),this.drawTarget.guide=!0,this.drawTarget.locked=!0,this.drawTarget.position=S.getRaster().position,this.draw(t.point.x,t.point.y),this.startPoint=t.point}handleMouseDrag(t){if(t.event.button>0||!this.active)return;this.drawTarget.canvas.getContext("2d").clearRect(0,0,wt,Ct),ft(this.startPoint,t.point,this.draw.bind(this))}handleMouseUp(t){t.event.button>0||!this.active||(this.drawTarget.remove(),this.drawTarget=S.getRaster(),ft(this.startPoint,t.point,this.draw.bind(this)),this.drawTarget=null,this.active=!1,this.updateCursorIfNeeded(),this.cursorPreview.position=new a.Point(~~t.point.x,~~t.point.y),this.onImageUpdate())}deactivate(){this.active=!1,this.tmpCanvas=null,this.cursorPreview&&(this.cursorPreview.remove(),this.cursorPreview=null)}}const hn=4,de=10;class Qs{constructor(e,t){h(this,"tool");h(this,"mode");h(this,"selectedItems");h(this,"selectionCenter");h(this,"boundsPath");h(this,"firstDrag");this.tool=e,this.mode=t,this.selectedItems=null,this.selectionCenter=null,this.boundsPath=null,this.firstDrag=!1}onMouseDown(e){let t=e.hitResult.item;if(!e.subselect){const i=z.getRootItem(e.hitResult.item);t=z.isCompoundPathItem(i)||z.isGroupItem(i)?i:e.hitResult.item}if(t.selected)if(e.doubleClicked){if(!e.multiselect){if(t instanceof a.PointText){this.tool.onSwitchToTextTool();return}b.clearSelection()}this._select(t,!0,e.subselect,!0)}else e.multiselect&&this._select(t,!1,e.subselect);else e.multiselect||b.clearSelection(),this._select(t,!0,e.subselect);if(e.clone&&b.cloneSelection(e.subselect),this.selectedItems=this.mode===m.RESHAPE?b.getSelectedLeafItems():b.getSelectedRootItems(),this.selectedItems.length===0)return;let s;for(const i of this.selectedItems)s?s=s.unite(i.bounds):s=i.bounds;this.selectionCenter=s.center,this.boundsPath&&this.selectedItems.push(this.boundsPath),this.firstDrag=!0}setBoundsPath(e){this.boundsPath=e}_select(e,t,s,i){s?(e.selected=!1,i?e.fullySelected=t:e.selected=t):b.setItemSelection(e,t),this.tool.setSelectedItems()}onMouseDrag(e){const t=e.point,s=Q.getActionBounds(Ci(this.mode));t.x=Math.max(s.left,Math.min(t.x,s.right)),t.y=Math.max(s.top,Math.min(t.y,s.bottom));const i=t.subtract(e.downPoint);let n;if(!e.modifiers.shift&&this.mode!==m.RESHAPE&&U.checkPointsClose(this.selectionCenter.add(i),D,hn/a.view.zoom)&&(n=D.subtract(this.selectionCenter)),this.selectedItems.length===0)return;let r;for(const c of this.selectedItems)c.data.origPos||(c.data.origPos=c.position),n?c.position=c.data.origPos.add(n):e.modifiers.shift?c.position=c.data.origPos.add(U.snapDeltaToAngle(i,Math.PI/4)):c.position=c.data.origPos.add(i),r?r=r.unite(c.bounds):r=c.bounds;this.firstDrag&&(S.getDragCrosshairLayer().visible=!0,this.firstDrag=!1);let l=1;const u=this.selectionCenter.add(i);if(D.y<r.top&&D.x<r.left||D.y>r.bottom&&D.x<r.left||D.y<r.top&&D.x>r.right||D.y>r.bottom&&D.x>r.right){const c=Math.max(D.x-r.right,r.left-D.x),f=Math.max(D.y-r.bottom,r.top-D.y),g=Math.sqrt(c*c+f*f);l=Math.max(0,1-g/(de/a.view.zoom))}else D.y<r.top||D.y>r.bottom?l=Math.max(0,1-(Math.abs(D.y-u.y)-r.height/2)/(de/a.view.zoom)):(D.x<r.left||D.x>r.right)&&(l=Math.max(0,1-(Math.abs(D.x-u.x)-r.width/2)/(de/a.view.zoom)));S.getDragCrosshairLayer().opacity=S.CROSSHAIR_FULL_OPACITY*l}onMouseUp(){this.firstDrag=!1;let e=!1;for(const t of this.selectedItems)t.data.origPos&&(t.position.equals(t.data.origPos)||(e=!0),delete t.data.origPos);this.selectedItems=null,this.selectionCenter=null,e&&this.tool.onImageUpdate(),S.getDragCrosshairLayer().visible=!1}}class cn{constructor(e){h(this,"onImageUpdate");h(this,"rotItems");h(this,"rotGroupPivot");h(this,"prevRot");this.onImageUpdate=e,this.rotItems=[],this.rotGroupPivot=null,this.prevRot=90}onMouseDown(e,t,s){this.rotGroupPivot=t.bounds.center;for(const i of s)i.parent instanceof a.Layer&&this.rotItems.push(i);this.prevRot=90}onMouseDrag(e){let t=e.point.subtract(this.rotGroupPivot).angle;e.modifiers.shift&&(t=Math.round(t/45)*45);for(let s=0;s<this.rotItems.length;s++)this.rotItems[s].rotate(t-this.prevRot,this.rotGroupPivot);this.prevRot=t}onMouseUp(e){e.event.button>0||(this.rotItems.length=0,this.rotGroupPivot=null,this.prevRot=90,this.onImageUpdate())}}const os=1e-4;class un{constructor(e,t){h(this,"isBitmap");h(this,"onImageUpdate");h(this,"active");h(this,"boundsPath");h(this,"pivot");h(this,"origPivot");h(this,"corner");h(this,"origSize");h(this,"origCenter");h(this,"itemGroup");h(this,"itemToInsertBelow");h(this,"lastPoint");h(this,"selectionAnchor");h(this,"isCorner");h(this,"centered");h(this,"lastSx");h(this,"lastSy");this.isBitmap=e,this.onImageUpdate=t,this.active=!1,this.boundsPath=null,this.pivot=null,this.origPivot=null,this.corner=null,this.origSize=null,this.origCenter=null,this.itemGroup=null,this.itemToInsertBelow=null,this.lastPoint=null}onMouseDown(e,t,s){if(this.active)return;this.active=!0;const i=e.item.data.index,n=fn(i),r=mn(i);this.pivot=t.bounds[n].clone(),this.origPivot=t.bounds[n].clone(),this.corner=t.bounds[r].clone(),this.selectionAnchor=t.selectionAnchor,this.origSize=this.corner.subtract(this.pivot),this.origCenter=t.bounds.center,this.isCorner=dn(i),this.centered=!1,this.lastSx=1,this.lastSy=1,this.boundsPath=t;const l=b.getItems({match:function(u){for(const c of s)if(!c.isBelow(u))return!1;return!0}});l.length>0&&(this.itemToInsertBelow=l[0]),this.itemGroup=new a.Group(s),this.itemGroup.addChild(t),this.itemGroup.insertBelow(this.itemToInsertBelow),this.itemGroup.data.isHelperItem=!0}onMouseDrag(e){if(!this.active)return;const t=e.point,s=Q.getActionBounds(this.isBitmap);t.x=Math.max(s.left,Math.min(t.x,s.right)),t.y=Math.max(s.top,Math.min(t.y,s.bottom)),this.lastPoint||(this.lastPoint=e.lastPoint);const i=t.subtract(this.lastPoint);this.lastPoint=t,e.modifiers.alt?(this.centered=!0,this.itemGroup.position=this.origCenter,this.pivot=this.origCenter):(this.centered&&(this.centered=!1,this.itemGroup.scale(1/this.lastSx,1/this.lastSy,this.pivot),this.selectionAnchor&&this.selectionAnchor.scale(this.lastSx,this.lastSy),this.lastSx=1,this.lastSy=1),this.pivot=this.origPivot),this.corner=this.corner.add(i);let n=this.corner.subtract(this.pivot);e.modifiers.alt&&(n=n.multiply(2));let r=1,l=1;Math.abs(this.origSize.x)>1e-7&&(r=n.x/this.origSize.x),Math.abs(this.origSize.y)>1e-7&&(l=n.y/this.origSize.y);const u=r>0?1:-1,c=l>0?1:-1;this.isCorner&&!e.modifiers.shift&&(r=l=Math.max(Math.abs(r),Math.abs(l)),r*=u,l*=c),r=u*Math.max(Math.abs(r),os),l=c*Math.max(Math.abs(l),os),this.itemGroup.scale(r/this.lastSx,l/this.lastSy,this.pivot),this.selectionAnchor&&this.selectionAnchor.scale(this.lastSx/r,this.lastSy/l),this.lastSx=r,this.lastSy=l}onMouseUp(){if(this.active&&(this.lastPoint=null,this.pivot=null,this.origPivot=null,this.corner=null,this.origSize=null,this.origCenter=null,this.lastSx=1,this.lastSy=1,this.centered=!1,!!this.itemGroup)){this.boundsPath.remove(),this.boundsPath=null;for(let e=0;e<this.itemGroup.children.length;e++){const t=this.itemGroup.children[e];t.data.isPGTextItem&&(t.data.wasScaled=!0)}if(this.itemToInsertBelow){for(const e=0;e<this.itemGroup.children.length;)this.itemGroup.children[e].insertBelow(this.itemToInsertBelow);this.itemToInsertBelow=null}else this.itemGroup.layer&&this.itemGroup.layer.addChildren(this.itemGroup.children);this.itemGroup.remove(),this.active=!1,this.onImageUpdate()}}}const dn=o=>{switch(o){case 0:case 2:case 4:case 6:return!0;default:return!1}},fn=o=>{switch(o){case 0:return"topRight";case 1:return"rightCenter";case 2:return"bottomRight";case 3:return"bottomCenter";case 4:return"bottomLeft";case 5:return"leftCenter";case 6:return"topLeft";case 7:return"topCenter"}},mn=o=>{switch(o){case 0:return"bottomLeft";case 1:return"leftCenter";case 2:return"topLeft";case 3:return"topCenter";case 4:return"topRight";case 5:return"rightCenter";case 6:return"bottomRight";case 7:return"bottomCenter"}},gn=12,pn="M19.28,1.09C19.28.28,19,0,18.2,0c-1.67,0-3.34,0-5,0-.34,0-.88.24-1,.47a1.4,1.4,0,0,0,.36,1.08,15.27,15.27,0,0,0,1.46,1.36A6.4,6.4,0,0,1,6.52,4,5.85,5.85,0,0,1,5.24,3,15.27,15.27,0,0,0,6.7,1.61,1.4,1.4,0,0,0,7.06.54C7,.3,6.44.07,6.1.06c-1.67,0-3.34,0-5,0C.28,0,0,.31,0,1.12c0,1.67,0,3.34,0,5a1.23,1.23,0,0,0,.49,1,1.22,1.22,0,0,0,1-.31A14.38,14.38,0,0,0,2.84,5.26l.73.62a9.45,9.45,0,0,0,7.34,2,9.45,9.45,0,0,0,4.82-2.05l.73-.62a14.38,14.38,0,0,0,1.29,1.51,1.22,1.22,0,0,0,1,.31,1.23,1.23,0,0,0,.49-1C19.31,4.43,19.29,2.76,19.28,1.09Z";var is;(function(o){o.SCALE="SCALE",o.ROTATE="ROTATE",o.MOVE="MOVE"})(is||(is={}));class St{constructor(e,t){h(this,"tool");h(this,"mode");h(this,"boundsPath");h(this,"boundsRect");h(this,"boundsScaleHandles");h(this,"boundsRotHandles");h(this,"modeMap");h(this,"onSelectionChanged");h(this,"setSelectionBounds");this.tool=e,this.mode=null,this.boundsPath=null,this.boundsRect=null,this.boundsScaleHandles=[],this.boundsRotHandles=[],this.onSelectionChanged=s=>{s&&s.length?this.setSelectionBounds():this.removeBoundsPath()},this.setSelectionBounds=()=>{this.removeBoundsPath();const s=b.getSelectedRootItems();if(s.length<=0)return;let i=null;for(const c of s){if(c instanceof a.Raster&&c.loaded===!1){c.onLoad=this.setSelectionBounds;return}i?i=i.unite(c.bounds):i=c.bounds}if(!this.boundsPath){this.boundsPath=new a.Group,this.boundsRect=new a.Path.Rectangle(i),this.boundsRect.curves[0].divideAtTime(.5),this.boundsRect.curves[2].divideAtTime(.5),this.boundsRect.curves[4].divideAtTime(.5),this.boundsRect.curves[6].divideAtTime(.5),this.boundsPath.addChild(this.boundsRect);const c=new a.Path.Rectangle({point:[-1,-6],size:[2,12],radius:1,insert:!1}),f=new a.Path.Rectangle({point:[-6,-1],size:[12,2],radius:1,insert:!1}),g=c.unite(f);this.boundsPath.addChild(g),this.boundsPath.selectionAnchor=g,this.modeMap.MOVE.setBoundsPath(this.boundsPath)}S.setGuideItem(this.boundsPath),this.boundsPath.data.isSelectionBound=!0,this.boundsPath.data.isHelperItem=!0,this.boundsPath.fillColor=null,this.boundsPath.parent=S.getGuideLayer(),this.boundsPath.strokeWidth=1/a.view.zoom,this.boundsPath.strokeColor=V.getGuideColor();const n=this.boundsPath.selectionAnchor;n.scale(gn/a.view.zoom/n.bounds.width),n.position=i.center;const r=new a.Path.Circle({center:new a.Point(0,0),radius:5.5/a.view.zoom,fillColor:"black",opacity:.12,data:{isHelperItem:!0,noSelect:!0,noHover:!0}}),l=new a.Path.Circle({center:new a.Point(0,0),radius:4/a.view.zoom,fillColor:V.getGuideColor(),data:{isScaleHandle:!0,isHelperItem:!0,noSelect:!0,noHover:!0}}),u=new a.Group([r,l]);u.parent=S.getGuideLayer();for(let c=0;c<this.boundsRect.segments.length;c++){const f=this.boundsRect.segments[c];if(c===7){const g=new a.Point(0,20),C=new a.Path(pn);C.translate(f.point.add(g).add(-10.5,-5));const w=new a.Path.Rectangle(f.point.add(g).subtract(1,0),f.point),y=C.unite(w);w.remove(),C.remove(),y.scale(1/a.view.zoom,f.point),y.data={offset:g,isRotHandle:!0,isHelperItem:!0,noSelect:!0,noHover:!0},y.fillColor=V.getGuideColor(),y.parent=S.getGuideLayer(),this.boundsRotHandles[c]=y}this.boundsScaleHandles[c]=u.clone(),this.boundsScaleHandles[c].position=f.point;for(const g of this.boundsScaleHandles[c].children)g.data.index=c;this.boundsScaleHandles[c].data={index:c,isScaleHandle:!0,isHelperItem:!0,noSelect:!0,noHover:!0}}u.remove()},this.modeMap={},this.modeMap.SCALE=new un(t in ImageBitmap,e.onImageUpdate),this.modeMap.ROTATE=new cn(e.onImageUpdate),this.modeMap.MOVE=new Qs(e,t)}onMouseDown(e,t,s,i,n){if(e.event.button>0)return;const{hitResult:r,mode:l}=this.determineMode(e,n);if(!r)return s||this.removeBoundsPath(),!1;this.mode=l;const u={hitResult:r,clone:t,multiselect:s,doubleClicked:i};return this.mode==="MOVE"&&(this.modeMap[this.mode].onMouseDown(u),this.removeBoundsHandles()),this.mode==="SCALE"&&(this.modeMap[this.mode].onMouseDown(r,this.boundsPath,b.getSelectedRootItems()),this.removeBoundsHandles()),this.mode==="ROTATE"&&(this.tool.setCursor(et.GRABBING),this.modeMap[this.mode].onMouseDown(r,this.boundsPath,b.getSelectedRootItems()),this.removeBoundsPath()),!0}onMouseMove(e,t){this.updateCursor(e,t)}updateCursor(e,t){const{mode:s,hitResult:i}=this.determineMode(e,t);if(!i){this.tool.setCursor(et.DEFAULT);return}if(s==="MOVE"&&this.tool.setCursor(et.DEFAULT),s==="ROTATE"&&this.tool.setCursor(et.GRAB),s==="SCALE"){this.setSelectionBounds();const{position:{x:n,y:r},bounds:{bottomLeft:l,topRight:u}}=this.boundsPath;this.impreciseEqual(i.item.position.x,n)?this.tool.setCursor(et.RESIZE_NS):this.impreciseEqual(i.item.position.y,r)?this.tool.setCursor(et.RESIZE_EW):i.item.position.equals(l)||i.item.position.equals(u)?this.tool.setCursor(et.RESIZE_NESW):this.tool.setCursor(et.RESIZE_NWSE)}}impreciseEqual(e,t){return Math.abs(e-t)<1e-8}determineMode(e,t){const s=a.project.hitTestAll(e.point,t);let i,n=s[0];for(let r=0;r<s.length;r++)if(s[r].item.data&&s[r].item.data.isScaleHandle){n=s[r],i="SCALE";break}else s[r].item.data&&s[r].item.data.isRotHandle&&(n=s[r],i="ROTATE");return i||(i="MOVE"),{mode:i,hitResult:n}}onMouseDrag(e){e.event.button>0||!this.mode||(this.modeMap[this.mode].onMouseDrag(e),this.mode==="MOVE"&&this.tool.setCursor(et.GRABBING))}onMouseUp(e,t){e.event.button>0||!this.mode||(this.modeMap[this.mode].onMouseUp(e),this.setSelectionBounds(),this.mode=null,this.updateCursor(e,t))}removeBoundsPath(){V.removeBoundsPath(),this.boundsPath=null,this.boundsRect=null,this.boundsScaleHandles.length=0,this.boundsRotHandles.length=0}removeBoundsHandles(){V.removeBoundsHandles(),this.boundsScaleHandles.length=0,this.boundsRotHandles.length=0}deactivate(){this.removeBoundsPath()}}const vn=15;class Bt{constructor(e,t,s=!1){h(this,"boundingBoxTool");h(this,"onImageUpdate");h(this,"isBitmap");h(this,"onKeyDown");h(this,"onKeyUp");this.boundingBoxTool=e,this.onImageUpdate=t,this.isBitmap=s,this.onKeyDown=i=>{if(i.event.target instanceof HTMLInputElement)return;let n=1/a.view.zoom;i.modifiers.shift&&(n*=vn);const r=b.getSelectedRootItems();if(r.length===0)return;let l;for(const y of r)l?l=l.unite(y.bounds):l=y.bounds;const u=Q.getActionBounds(this.isBitmap),c=u.bottom-l.top-1,f=u.top-l.bottom+1,g=u.left-l.right+1,C=u.right-l.left-1;let w;if(i.key==="up"?w=new a.Point(0,Math.min(c,Math.max(-n,f))):i.key==="down"?w=new a.Point(0,Math.max(f,Math.min(n,c))):i.key==="left"?w=new a.Point(Math.min(C,Math.max(-n,g)),0):i.key==="right"&&(w=new a.Point(Math.max(g,Math.min(n,C)),0)),w){for(const y of r)y.translate(w);this.boundingBoxTool.setSelectionBounds(),i.preventDefault()}},this.onKeyUp=i=>{b.getSelectedRootItems().length!==0&&(i.key==="up"||i.key==="down"||i.key==="left"||i.key==="right")&&this.onImageUpdate()}}}class Zt extends ${constructor(){super();h(this,"boundingBoxTool");h(this,"oval",null);h(this,"thickness",2);h(this,"filled",!1);h(this,"isBoundingBoxMode",!1);h(this,"onSelectionChanged",t=>{(!this.oval||!this.oval.isInserted())&&t&&t.length===1&&t[0].shape==="ellipse"?(this.oval=t[0],this.oval.data.zoomLevel!==a.view.zoom&&(this.oval.strokeWidth=this.oval.strokeWidth/this.oval.data.zoomLevel*a.view.zoom,this.oval.data.zoomLevel=a.view.zoom,this.thickness=this.oval.strokeWidth),this.filled=this.oval.strokeWidth===0):this.oval&&this.oval.isInserted()&&!this.oval.selected&&this.commitOval()});this.boundingBoxTool=new St(this,m.BIT_OVAL),this.childTools.push(this.boundingBoxTool);const t=new Bt(this.boundingBoxTool,this.onImageUpdate,!0);this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag),this.on("mouseup",this.handleMouseUp),this.on("mousemove",this.handleMouseMove),this.on("keydown",t.onKeyDown),this.on("keyup",t.onKeyUp),this.setFilled(!0),this.setThickness(10)}static get TOLERANCE(){return 2}get color(){return this.store.fillColor}deactivate(){super.deactivate(),this.commitOval(),this.boundingBoxTool.deactivate()}getHitOptions(){return{segments:!1,stroke:!0,curves:!1,fill:!0,guide:!1,match:t=>t.item.data&&(t.item.data.isScaleHandle||t.item.data.isRotHandle)||t.item.selected,tolerance:Zt.TOLERANCE/a.view.zoom}}styleOval(){at(this.oval,{fillColor:this.filled?this.color:null,strokeColor:this.filled?null:this.color,strokeWidth:this.filled?0:this.thickness})}setFilled(t){this.filled!==t&&(this.filled=t,this.oval&&this.oval.isInserted()&&(this.styleOval(),this.onImageUpdate()))}setThickness(t){this.thickness!==t*a.view.zoom&&(this.thickness=t*a.view.zoom,this.oval&&this.oval.isInserted()&&!this.filled&&(this.oval.strokeWidth=this.thickness),this.oval&&this.oval.isInserted()&&(this.oval.data.zoomLevel=a.view.zoom,this.onImageUpdate()))}handleMouseDown(t){t.event.button>0||(this.active=!0,this.boundingBoxTool.onMouseDown(t,!1,!1,!1,this.getHitOptions())?this.isBoundingBoxMode=!0:(this.isBoundingBoxMode=!1,b.clearSelection(),this.commitOval(),this.oval=new a.Shape.Ellipse({point:t.downPoint,size:0,strokeScaling:!1}),this.styleOval(),this.oval.data={zoomLevel:a.view.zoom}))}handleMouseDrag(t){if(t.event.button>0||!this.active)return;if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseDrag(t);return}const s=new a.Point(t.downPoint.x,t.downPoint.y),i=new a.Point(t.point.x,t.point.y),n=U.getSquareDimensions(t.downPoint,t.point);t.modifiers.shift?this.oval.size=n.size.abs():this.oval.size=s.subtract(i),t.modifiers.alt?this.oval.position=s:t.modifiers.shift?this.oval.position=n.position:this.oval.position=s.subtract(this.oval.size.multiply(.5)),this.styleOval()}handleMouseMove(t){this.boundingBoxTool.onMouseMove(t,this.getHitOptions())}handleMouseUp(t){if(!(t.event.button>0||!this.active)){if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseUp(t),this.isBoundingBoxMode=!1;return}this.oval&&(Math.abs(this.oval.size.width*this.oval.size.height)<Zt.TOLERANCE/a.view.zoom?(this.oval.remove(),this.oval=null):(this.oval.size=new a.Point(Math.abs(this.oval.size.width),Math.abs(this.oval.size.height)),this.oval.selected=!0,this.styleOval(),this.setSelectedItems())),this.active=!1,this.onImageUpdate()}}commitOval(){!this.oval||!this.oval.isInserted()||($s(this.oval,S.getRaster()),this.oval.remove(),this.oval=null)}}class Kt extends ${constructor(){super();h(this,"boundingBoxTool");h(this,"rect",null);h(this,"thickness",2);h(this,"filled",!1);h(this,"isBoundingBoxMode",!1);h(this,"onSelectionChanged",t=>{(!this.rect||!this.rect.isInserted())&&t&&t.length===1&&t[0].shape==="rectangle"?(this.rect=t[0],this.rect.data.zoomLevel!==a.view.zoom&&(this.rect.strokeWidth=this.rect.strokeWidth/this.rect.data.zoomLevel*a.view.zoom,this.rect.data.zoomLevel=a.view.zoom,this.thickness=this.rect.strokeWidth),this.filled=this.rect.strokeWidth===0):this.rect&&this.rect.isInserted()&&!this.rect.selected&&this.commitRect()});this.boundingBoxTool=new St(this,m.BIT_RECT),this.childTools.push(this.boundingBoxTool);const t=new Bt(this.boundingBoxTool,this.onImageUpdate,!0);this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag),this.on("mouseup",this.handleMouseUp),this.on("mousemove",this.handleMouseMove),this.on("keydown",t.onKeyDown),this.on("keyup",t.onKeyUp),this.setFilled(!0),this.setThickness(2)}static get TOLERANCE(){return 2}deactivate(){super.deactivate(),this.commitRect(),this.boundingBoxTool.deactivate()}getHitOptions(){return{segments:!1,stroke:!0,curves:!1,fill:!0,guide:!1,match:t=>t.item.data&&(t.item.data.isScaleHandle||t.item.data.isRotHandle)||t.item.selected,tolerance:Kt.TOLERANCE/a.view.zoom}}styleRect(){at(this.rect,{fillColor:this.filled?this.fillColor:null,strokeColor:this.filled?null:this.fillColor,strokeWidth:this.filled?0:this.thickness})}setFilled(t){this.filled!==t&&(this.filled=t,this.rect&&this.rect.isInserted()&&(this.styleRect(),this.onImageUpdate()))}setThickness(t){this.thickness!==t*a.view.zoom&&(this.thickness=t*a.view.zoom,this.rect&&this.rect.isInserted()&&!this.filled&&(this.rect.strokeWidth=this.thickness),this.rect&&this.rect.isInserted()&&(this.rect.data.zoomLevel=a.view.zoom,this.onImageUpdate()))}handleMouseDown(t){t.event.button>0||(this.active=!0,this.boundingBoxTool.onMouseDown(t,!1,!1,!1,this.getHitOptions())?this.isBoundingBoxMode=!0:(this.isBoundingBoxMode=!1,b.clearSelection(),this.commitRect()))}handleMouseDrag(t){if(t.event.button>0||!this.active)return;if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseDrag(t);return}const s=t.point.subtract(t.downPoint),i=new a.Rectangle(t.downPoint,t.point),n=U.getSquareDimensions(t.downPoint,t.point);t.modifiers.shift&&(i.size=n.size.abs()),this.rect&&this.rect.remove(),this.rect=new a.Shape.Rectangle(i),this.rect.strokeJoin="round",this.rect.strokeScaling=!1,this.rect.data={zoomLevel:a.view.zoom},this.styleRect(),t.modifiers.alt?this.rect.position=t.downPoint:t.modifiers.shift?this.rect.position=n.position:this.rect.position=t.downPoint.add(s.multiply(.5))}handleMouseMove(t){this.boundingBoxTool.onMouseMove(t,this.getHitOptions())}handleMouseUp(t){if(!(t.event.button>0||!this.active)){if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseUp(t),this.isBoundingBoxMode=!1;return}this.rect&&(Math.abs(this.rect.size.width*this.rect.size.height)<Kt.TOLERANCE/a.view.zoom?(this.rect.remove(),this.rect=null):(this.rect.size=new a.Point(Math.abs(this.rect.size.width),Math.abs(this.rect.size.height)),this.rect.selected=!0,this.styleRect(),this.setSelectedItems())),this.active=!1,this.onImageUpdate()}}commitRect(){!this.rect||!this.rect.isInserted()||(qs(this.rect,S.getRaster()),this.rect.remove(),this.rect=null)}}class ke{constructor(e,t){h(this,"tool");h(this,"selectionRect");h(this,"mode");this.tool=e,this.selectionRect=null,this.mode=t}onMouseDown(e){e||b.clearSelection()}onMouseDrag(e){e.event.button>0||(this.selectionRect&&this.selectionRect.remove(),this.selectionRect=V.rectSelect(e))}onMouseUpVector(e){e.event.button>0||this.selectionRect&&(b.processRectangularSelection(e,this.selectionRect,this.mode),this.selectionRect.remove(),this.selectionRect=null,this.tool.setSelectedItems())}onMouseUpBitmap(e){if(!(e.event.button>0)&&this.selectionRect){let t=new a.Rectangle({from:new a.Point(Math.max(0,Math.round(this.selectionRect.bounds.topLeft.x)),Math.max(0,Math.round(this.selectionRect.bounds.topLeft.y))),to:new a.Point(Math.min(wt,Math.round(this.selectionRect.bounds.bottomRight.x)),Math.min(Ct,Math.round(this.selectionRect.bounds.bottomRight.y)))});if(t=oe(S.getRaster(),t),t.area){const s=S.getRaster().getSubRaster(t);s.parent=a.project.activeLayer,s.canvas.getContext("2d").imageSmoothingEnabled=!1,s.selected=!0;const i=S.getRaster().getSubRaster(t.expand(4));i.remove(),s.data={expanded:i},S.getRaster().getContext(!0).clearRect(t.x,t.y,t.width,t.height),this.tool.setSelectedItems()}this.selectionRect.remove(),this.selectionRect=null}}}let wn=class to extends ${constructor(){super();h(this,"boundingBoxTool");h(this,"selectionBoxTool",new ke(this,m.BIT_SELECT));h(this,"selectionBoxMode",!1);h(this,"selection",null);h(this,"onSelectionChanged",t=>{this.selection&&this.selection.parent&&!this.selection.selected&&this.commitSelection(),(!this.selection||!this.selection.parent)&&t&&t.length===1&&t[0]instanceof a.Raster&&(this.selection=t[0])});this.boundingBoxTool=new St(this,m.BIT_SELECT),this.childTools.push(this.boundingBoxTool);const t=new Bt(this.boundingBoxTool,this.onImageUpdate,!0);this.onMouseDown=this.handleMouseDown,this.onMouseDrag=this.handleMouseDrag,this.onMouseMove=this.handleMouseMove,this.onMouseUp=this.handleMouseUp,this.onKeyUp=t.onKeyUp,this.onKeyDown=t.onKeyDown,this.boundingBoxTool.setSelectionBounds()}static get TOLERANCE(){return 2}deactivate(){super.deactivate(),this.commitSelection(),this.boundingBoxTool.deactivate()}handleMouseDown(t){t.event.button>0||(this.active=!0,this.boundingBoxTool.onMouseDown(t,t.modifiers.alt,t.modifiers.shift,!1,this.getHitOptions())||(this.commitSelection(),this.selectionBoxMode=!0,this.selectionBoxTool.onMouseDown(t.modifiers.shift)))}handleMouseDrag(t){t.event.button>0||!this.active||(this.selectionBoxMode?this.selectionBoxTool.onMouseDrag(t):this.boundingBoxTool.onMouseDrag(t))}handleMouseMove(t){this.boundingBoxTool.onMouseMove(t,this.getHitOptions())}handleMouseUp(t){t.event.button>0||!this.active||(this.selectionBoxMode?this.selectionBoxTool.onMouseUpBitmap(t):this.boundingBoxTool.onMouseUp(t),this.selectionBoxMode=!1,this.active=!1)}commitSelection(){!this.selection||!this.selection.parent||(Zs(this.selection,S.getRaster()),this.selection.remove(),this.selection=null,this.emit("Image",{}))}getHitOptions(){return{segments:!0,stroke:!0,curves:!0,fill:!0,guide:!1,tolerance:to.TOLERANCE/a.view.zoom,match:t=>!t.item.data||!t.item.data.isHelperItem?!0:t.item.data.isScaleHandle||t.item.data.isRotHandle}}};class Cn{constructor(){h(this,"lastVec",null);h(this,"lastPoint",null);h(this,"finalPath",null);h(this,"smoothed",0);h(this,"smoothingThreshold",20);h(this,"steps",0);h(this,"endCaps",[])}onBroadMouseDown(e,t){this.steps=0,this.smoothed=0,this.lastVec=null;const s=t.size;t.minDistance=Math.min(5,Math.max(2/a.view.zoom,s/2)),t.maxDistance=s,!(e.event.button>0)&&(this.finalPath=new a.Path.Circle({center:e.point,radius:s/2}),t.styleBlob(this.finalPath),this.lastPoint=e.point)}onBroadMouseDrag(e,t){const s=t.size,i=t.fillColor;this.steps++;const n=e.delta.normalize(s/2);if(this.lastVec){const r=this.lastVec.getDirectedAngle(n);if(Math.abs(r)>126){this.simplify(1),this.smoothed++;const l=new a.Path.Circle(this.lastPoint,s/2);l.fillColor=i.primary;const u=new a.Path.Rectangle(this.lastPoint.subtract(new a.Point(-s/2,0)),this.lastPoint.subtract(new a.Point(s/2,this.lastVec.length)));u.fillColor=i.primary,u.rotate(this.lastVec.angle-90,this.lastPoint);const c=new a.Path.Rectangle(e.point.subtract(new a.Point(-s/2,0)),e.point.subtract(new a.Point(s/2,e.delta.length)));c.fillColor=i.primary,c.rotate(n.angle-90,e.point),this.endCaps.push(this.union(l,this.union(u,c)))}}if(n.angle+=90,this.steps===1){this.finalPath.remove(),this.finalPath=new a.Path;const r=e.delta.normalize(s/2);this.finalPath.add(new a.Segment(this.lastPoint.subtract(r),r.rotate(-90),r.rotate(90))),t.styleBlob(this.finalPath),this.finalPath.insert(0,new a.Segment(this.lastPoint.subtract(n))),this.finalPath.add(new a.Segment(this.lastPoint.add(n)))}if(this.lastVec){const r=this.lastVec.normalize(s/2).rotate(90),l=new a.Point(r.x+n.x,r.y+n.y).normalize(s/2);this.finalPath.segments[0].point=this.lastPoint.subtract(l),this.finalPath.segments[this.finalPath.segments.length-1].point=this.lastPoint.add(l)}this.finalPath.add(e.point.add(n)),this.finalPath.insert(0,e.point.subtract(n)),this.finalPath.segments.length>this.smoothed+this.smoothingThreshold*2&&this.simplify(1),this.lastVec=e.delta,this.lastPoint=e.point}simplify(e){const t=this.finalPath.segments.length,s=Math.floor((t-this.smoothed)/2)+1,i=Math.min(s+1,Math.floor(t/2)),n=Math.max(t-1-s,Math.floor(t/2)+1);if(i<=1||n>=t-1)return;const r=new a.Path(this.finalPath.segments.slice(1,i)),l=new a.Path(this.finalPath.segments.slice(i,n)),u=new a.Path(this.finalPath.segments.slice(n,t-1)),c=r.segments[r.segments.length-1],f=u.segments[0];r.simplify(e),u.simplify(e);const g=r.segments[r.segments.length-1],C=u.segments[0];g.handleOut=c.handleOut,C.handleIn=f.handleIn,this.finalPath.removeSegments(1,this.finalPath.segments.length-1),this.finalPath.insertSegments(1,r.segments.concat(l.segments).concat(u.segments)),r.remove(),u.remove(),l.remove(),this.smoothed=Math.max(2,this.finalPath.segments.length)}union(e,t){const s=e.unite(t);return e.remove(),t.remove(),s}onBroadMouseUp(e,t){const s=t.size;if(this.steps===0)return this.endCaps.length=0,this.finalPath;let i=this.lastVec;if(!e.point.equals(this.lastPoint)){i=e.point.subtract(this.lastPoint);const l=i.normalize(s/2);l.angle+=90;const u=e.point.add(l),c=e.point.subtract(l);this.finalPath.add(u),this.finalPath.insert(0,c)}this.simplify(1);const n=i.normalize(s/2);this.finalPath.add(new a.Segment(e.point.add(n),n.rotate(90),n.rotate(-90))),this.finalPath.closePath();const r=this.finalPath.resolveCrossings().reorient(!0,!0).reduce({simplify:!0});r!==this.finalPath&&(r.copyAttributes(this.finalPath),r.fillColor=this.finalPath.fillColor,this.finalPath.remove(),this.finalPath=r);for(const l of this.endCaps){const u=this.union(this.finalPath,l);u.area>=this.finalPath.area&&!(u instanceof a.CompoundPath&&!(this.finalPath instanceof a.CompoundPath))?this.finalPath=u:(this.finalPath.insertAbove(u),u.remove())}return this.endCaps.length=0,this.finalPath}}class bn{constructor(){h(this,"lastPoint",null);h(this,"finalPath",null);h(this,"firstCircle",null)}onSegmentMouseDown(e,t){const s=t.size;t.minDistance=2/a.view.zoom,t.maxDistance=s,this.firstCircle=new a.Path.Circle({center:e.point,radius:s/2}),this.finalPath=this.firstCircle,t.styleBlob(this.finalPath),this.lastPoint=e.point}onSegmentMouseDrag(e,t){const s=t.size,i=e.delta.normalize(s/2),n=i.clone();n.length=s/2,n.angle+=90;const r=new a.Path;t.styleBlob(r),r.add(new a.Segment(this.lastPoint.subtract(i),n.multiply(-1),n)),i.angle+=90,r.add(e.lastPoint.add(i)),r.insert(0,e.lastPoint.subtract(i)),r.add(e.point.add(i)),r.insert(0,e.point.subtract(i)),i.angle-=90,r.add(new a.Segment(e.point.add(i),n,n.multiply(-1))),r.closed=!0,r.flatten(Math.min(5,s/5)),this.lastPoint=e.point;const l=this.finalPath.unite(r);r.remove(),this.finalPath.remove(),this.finalPath=l}onSegmentMouseUp(){if(this.finalPath.segments&&this.finalPath.segments.length>4){this.finalPath.closed=!1,this.finalPath.simplify(2),this.finalPath.closed=!0;const e=this.finalPath.unite(this.firstCircle);this.finalPath.remove(),this.finalPath=e}return this.finalPath}}var ns;(function(o){o.BROAD="broadbrush",o.SEGMENT="segmentbrush"})(ns||(ns={}));class $t extends ${constructor(t=!1){super();h(this,"isEraser");h(this,"broadBrushHelper");h(this,"segmentBrushHelper");h(this,"cursorPreview");h(this,"cursorPreviewLastPoint");h(this,"brush");h(this,"onMouseMove");h(this,"onMouseDown");h(this,"onMouseDrag");h(this,"onMouseUp");this.isEraser=t,this.broadBrushHelper=new Cn,this.segmentBrushHelper=new bn,this.cursorPreview=null,this.cursorPreviewLastPoint=new a.Point(-1e4,-1e4),this.onMouseMove=s=>{this.updateCursorIfNeeded(s.point)},this.onMouseDown=s=>{s.event.button>0||(this.updateCursorIfNeeded(s.point),this.active=!0,this.size<$t.THRESHOLD?(this.brush="broadbrush",this.broadBrushHelper.onBroadMouseDown(s,this)):(this.brush="segmentbrush",this.segmentBrushHelper.onSegmentMouseDown(s,this)))},this.onMouseDrag=s=>{s.event.button>0||!this.active||(this.brush==="broadbrush"?this.broadBrushHelper.onBroadMouseDrag(s,this):this.segmentBrushHelper.onSegmentMouseDrag(s,this),this.cursorPreview.bringToFront(),this.cursorPreview.position=s.point)},this.onMouseUp=s=>{if(s.event.button>0||!this.active)return;let i;this.brush==="broadbrush"?i=this.broadBrushHelper.onBroadMouseUp(s,this):i=this.segmentBrushHelper.onSegmentMouseUp(),this.isEraser?this.mergeEraser(i):this.mergeBrush(i),this.fixedDistance=1,this.active=!1,this.onImageUpdate()},this.fixedDistance=1,this.on("mousemove",this.onMouseMove),this.on("mousedown",this.onMouseDown),this.on("mousedrag",this.onMouseDrag),this.on("mouseup",this.onMouseUp)}static get THRESHOLD(){return 30/a.view.zoom}get size(){return this.isEraser?this.eraserSize:this.brushSize}createCursorPreview(){this.cursorPreview||(this.cursorPreview=new a.Shape.Ellipse({point:this.cursorPreviewLastPoint,size:this.size/2}),this.cursorPreview.parent=S.getGuideLayer(),this.cursorPreview.data.isHelperItem=!0,S.setGuideItem(this.cursorPreview))}styleCursorPreview(t){var s;this.cursorPreview&&(this.cursorPreview.position=t,this.cursorPreview.radius=this.size/2,this.isEraser?(this.cursorPreview.fillColor="white",this.cursorPreview.strokeColor="cornflowerblue",this.cursorPreview.strokeWidth=1):this.cursorPreview.fillColor=((s=this.fillColor)==null?void 0:s.primary)??null)}styleBlob(t){var s;this.isEraser?t.fillColor="white":t.fillColor=((s=this.fillColor)==null?void 0:s.primary)??null}updateCursorIfNeeded(t){this.cursorPreview&&!this.cursorPreview.parent&&(this.cursorPreview=null),!(this.cursorPreview&&this.cursorPreviewLastPoint.equals(t))&&(t&&(this.cursorPreviewLastPoint=t),this.createCursorPreview(),this.styleCursorPreview(this.cursorPreviewLastPoint),this.cursorPreview.bringToFront())}mergeBrush(t){const s=b.getItems({match:l=>this.isMergeable(t,l)&&l.parent instanceof a.Layer});let i=t,n;for(n=s.length-1;n>=0&&!this.touches(s[n],t);n--);let r=n;for(;n>=0;n--){const l=s[n];if(this.touches(l,t)&&l.fillColor){if(this.colorMatch(l,t)){for(let c=r;c>n;c--)this.touches(s[c],s[n]);const u=i.unite(s[n]);u.strokeColor=s[n].strokeColor,u.strokeWidth=s[n].strokeWidth,i===t?u.insertAbove(s[n]):(u.insertAbove(i),r--),i.remove(),i=u,s[n].remove(),s.splice(n,1)}}}}mergeEraser(t){let s=b.getItems({match:i=>i.selected&&this.isMergeable(t,i)&&this.touches(t,i)&&!be(i),class:a.PathItem});s.length===0&&(b.clearSelection(),s=b.getItems({match:i=>this.isMergeable(t,i)&&this.touches(t,i)&&!be(i),class:a.PathItem}));for(let i=s.length-1;i>=0;i--){const n=s[i];if(n instanceof a.Path&&(!n.fillColor||n.fillColor.alpha===0)){const u=[],c=s[i],f=c.getIntersections(t);for(let g=f.length-1;g>=0;g--){const C=c.splitAt(f[g]);C&&(C.insertAbove(c),u.push(C))}u.push(c);for(let g=u.length-1;g>=0;g--){const C=u[g].getLocationAt(u[g].length/2).point;t.contains(C)&&(u[g].remove(),u.splice(g,1))}t.remove();continue}const r=n.subtract(t);r.insertBelow(n);const l=[];if(n instanceof a.Path&&!n.closed){const u=n.clone(),c=u.getIntersections(t);for(let f=c.length-1;f>=0;f--){const g=u.splitAt(c[f]);g.insertAbove(u),l.push(g)}l.push(u)}for(let u=l.length-1;u>=0;u--){const c=l[u].getLocationAt(l[u].length/2).point;(t.contains(c)||r.contains(c))&&(l[u].remove(),l.splice(u,1))}r.children&&(this.separateCompoundPath(r),r.remove()),s[i].remove()}t.remove()}separateCompoundPath(t){t.clockwise||t.reverse();const s=[],i=[];for(let n=t.children.length-1;n>=0;n--){const r=t.children[n];r.clockwise?s.push(r):i.push(r)}s.sort((n,r)=>n.area-r.area),i.sort((n,r)=>Math.abs(n.area)-Math.abs(r.area));for(let n=0;n<s.length;n++){const r=s[n];r.copyAttributes(t),r.fillColor=t.fillColor,r.strokeColor=t.strokeColor,r.strokeWidth=t.strokeWidth,r.insertAbove(t);let l=r;for(let u=i.length-1;u>=0;u--){const c=i[u];if(this.firstEnclosesSecond(r,c)){const f=l.subtract(c);f.insertAbove(t),l.remove(),l=f,c.remove(),i.splice(u,1)}}}}colorMatch(t,s){return t.getFillColor().equals(s.getFillColor())&&(s.getStrokeColor()===t.getStrokeColor()||s.getStrokeColor()&&s.getStrokeColor().equals(t.getStrokeColor()))&&s.getStrokeWidth()===t.getStrokeWidth()&&this.touches(t,s)}touches(t,s){return t&&s&&t.intersects(s)?!0:this.firstEnclosesSecond(t,s)||this.firstEnclosesSecond(s,t)}firstEnclosesSecond(t,s){return!!(t&&s&&s.firstSegment&&s.firstSegment.point&&t.hitTest(s.firstSegment.point))}matchesAnyChild(t,s){for(const i of t.children)if(i.children&&this.matchesAnyChild(s,i)||s===i)return!0;return!1}isMergeable(t,s){if(s instanceof a.PathItem)return t.children&&this.matchesAnyChild(t,s)?!1:s!==t}deactivate(){this.cursorPreview&&this.cursorPreview.remove()}}const ut=class ut{};h(ut,"currentHoveredItem",null),h(ut,"clearHoveredItem",()=>{ut.currentHoveredItem!==null&&(ut.currentHoveredItem.remove(),ut.currentHoveredItem=null)}),h(ut,"getHoveredItem",(e,t,s)=>{const i=t.match;t.match=c=>c.item.data&&c.item.data.noHover?!1:i?i(c):!0;const n=a.project.hitTestAll(e.point,t);if(n.length===0)return null;let r;for(const c of n)(!r||U.sortItemsByZIndex(r.item,c.item)<0)&&(r=c);const l=r.item;if(!l||l.selected)return null;let u;return z.isBoundsItem(l)?u=V.hoverBounds(l):!s&&se.isGroupChild(l)?u=V.hoverBounds(z.getRootItem(l)):u=V.hoverItem(l),u.data.hitResult=r,u});let F=ut;class Sn{constructor(e){h(this,"tool");h(this,"hitType");h(this,"selectedItems");this.tool=e,this.hitType=null,this.selectedItems=[]}onMouseDown(e){e.multiselect||b.clearSelection(),e.hitResult.segment.handleIn.selected=!0,e.hitResult.segment.handleOut.selected=!0,this.hitType=e.hitResult.type}onMouseDrag(e){this.selectedItems=b.getSelectedLeafItems();for(const t of this.selectedItems)for(const s of t.segments)s.origPoint||(s.origPoint=s.point.clone()),s.handleOut.selected&&this.hitType==="handle-out"?e.modifiers.option||!s.handleOut.isColinear(s.handleIn)?s.handleOut=s.handleOut.add(e.delta):(s.handleOut=s.handleOut.add(e.delta),s.handleIn=s.handleOut.multiply(-s.handleIn.length/s.handleOut.length)):s.handleIn.selected&&this.hitType==="handle-in"&&(e.modifiers.option||!s.handleOut.isColinear(s.handleIn)?s.handleIn=s.handleIn.add(e.delta):(s.handleIn=s.handleIn.add(e.delta),s.handleOut=s.handleIn.multiply(-s.handleOut.length/s.handleIn.length)))}onMouseUp(){let e=!1;for(const t of this.selectedItems){if(!t.segments)return;for(const s of t.segments)s.origPoint&&!s.equals(s.origPoint)&&(e=!0),s.origPoint=null}e&&(this.tool.setSelectedItems(),this.tool.onImageUpdate()),this.selectedItems=[]}}class In{constructor(e){h(this,"tool");h(this,"deselectOnMouseUp");h(this,"deleteOnMouseUp");h(this,"invertDeselect");h(this,"lastPoint");this.tool=e,this.deselectOnMouseUp=null,this.deleteOnMouseUp=null,this.invertDeselect=!1,this.lastPoint=null}onMouseDown(e){e.doubleClicked&&(this.deleteOnMouseUp=e.hitResult),e.hitResult.segment.selected?e.multiselect?this.deselectOnMouseUp=e.hitResult.segment:(this.deselectOnMouseUp=e.hitResult.segment,this.invertDeselect=!0,e.hitResult.segment.selected=!0):(e.multiselect||b.clearSelection(),e.hitResult.segment.selected=!0)}addPoint(e){const t=e.hitResult.item.divideAt(e.hitResult.location);t.hasHandles()||t.smooth(),e.hitResult.segment=t,e.multiselect||b.clearSelection(),t.selected=!0}removePoint(e){const t=e.segment.index,s=e.item;s.removeSegment(t);const i=s.segments[t-1],n=s.segments[t];i&&i.handleOut&&(n?i.handleOut=i.handleOut.multiply(i.curve.length*U.HANDLE_RATIO/i.handleOut.length):i.handleOut=null),n&&n.handleIn&&(i?n.handleIn=n.handleIn.multiply(i.curve.length*U.HANDLE_RATIO/n.handleIn.length):n.handleIn=null)}onMouseDrag(e){this.deselectOnMouseUp=null,this.invertDeselect=!1,this.deleteOnMouseUp=null;const t=e.point,s=Q.getActionBounds();t.x=Math.max(s.left,Math.min(t.x,s.right)),t.y=Math.max(s.top,Math.min(t.y,s.bottom)),this.lastPoint||(this.lastPoint=e.lastPoint);const i=t.subtract(e.downPoint),n=t.subtract(this.lastPoint);this.lastPoint=t;const r=b.getSelectedSegments();for(const l of r)l.origPoint||(l.origPoint=l.point.clone()),e.modifiers.shift?l.point=l.origPoint.add(U.snapDeltaToAngle(i,Math.PI/4)):l.point=l.point.add(n)}onMouseUp(){this.lastPoint=null;let e=!1;const t=b.getSelectedSegments();for(const s of t)s.origPoint&&!s.equals(s.origPoint)&&(e=!0),s.origPoint=null;this.deselectOnMouseUp&&(this.invertDeselect?(b.clearSelection(),this.deselectOnMouseUp.selected=!0):this.deselectOnMouseUp.selected=!1,this.deselectOnMouseUp=null,this.invertDeselect=!1),this.deleteOnMouseUp&&this.removePoint(this.deleteOnMouseUp),this.tool.setSelectedItems(),(e||this.deleteOnMouseUp)&&(this.deleteOnMouseUp=null,this.tool.onImageUpdate())}}var rs;(function(o){o.FILL="FILL",o.POINT="POINT",o.HANDLE="HANDLE",o.SELECTION_BOX="SELECTION_BOX"})(rs||(rs={}));class st extends ${constructor(){super();h(this,"lastEvent");h(this,"mode","SELECTION_BOX");h(this,"modeMap");const t=new Qs(this,m.RESHAPE),s=new In(this),i=new Sn(this),n=new ke(this,m.RESHAPE);this.modeMap={FILL:t,POINT:s,HANDLE:i,SELECTION_BOX:n},this.on("mousedown",this.handleMouseDown),this.on("mousemove",this.handleMouseMove),this.on("mousedrag",this.handleMouseDrag),this.on("mouseup",this.handleMouseUp),this.on("keydown",this.handleKeyDown),this.on("keyup",this.handleKeyUp),a.settings.handleSize=st.HANDLE_RADIUS*2-2.5}static get TOLERANCE(){return st.HANDLE_RADIUS+st.HANDLE_PADDING}static get HANDLE_PADDING(){return 1}static get HANDLE_RADIUS(){return 5.25}static get DOUBLE_CLICK_MILLIS(){return 250}getSelectedSegmentHitOptions(){return{segments:!0,tolerance:st.TOLERANCE/a.view.zoom,match:s=>!(s.type!=="segment"||s.item.data&&s.item.data.noHover||!s.item.selected)}}getHandleHitOptions(){return{handles:!0,tolerance:st.TOLERANCE/a.view.zoom,match:s=>!(s.item.data&&s.item.data.noHover||!s.segment||!s.segment.selected||s.item.fullySelected)}}getSelectedStrokeHitOptions(){return{segments:!1,stroke:!1,curves:!0,handles:!1,fill:!1,guide:!1,tolerance:st.TOLERANCE/a.view.zoom,match:s=>!(s.type!=="curve"||!s.item.selected||s.item.data&&s.item.data.noHover)}}getUnselectedAndFillHitOptions(){return{fill:!0,stroke:!0,curves:!0,tolerance:st.TOLERANCE/a.view.zoom,match:s=>!(s.item.data&&s.item.data.noHover)}}getHitResult(t){let s=a.project.hitTestAll(t,this.getSelectedSegmentHitOptions());if(s.length||(s=a.project.hitTestAll(t,this.getHandleHitOptions())),s.length||(s=a.project.hitTestAll(t,this.getSelectedStrokeHitOptions())),s.length||(s=a.project.hitTestAll(t,this.getUnselectedAndFillHitOptions())),!s.length)return null;let i;for(const n of s)(!i||U.sortItemsByZIndex(i.item,n.item)<0)&&(i=n);return i}handleMouseDown(t){if(t.event.button>0)return;this.active=!0,F.clearHoveredItem();let s=!1;this.lastEvent&&(t.event.timeStamp-this.lastEvent.event.timeStamp<st.DOUBLE_CLICK_MILLIS?s=!0:s=!1),this.lastEvent=t;const i=this.getHitResult(t.point);if(!i){this.modeMap.SELECTION_BOX.onMouseDown(t.modifiers.shift);return}const n={hitResult:i,clone:t.modifiers.alt,multiselect:t.modifiers.shift,doubleClicked:s,subselect:!0};!i.item.selected||i.type==="fill"||i.type==="stroke"||i.type!=="segment"&&s?(this.mode="FILL",this.modeMap[this.mode].onMouseDown(n)):i.type==="segment"?(this.mode="POINT",this.modeMap[this.mode].onMouseDown(n)):i.type==="curve"?(this.mode="POINT",this.modeMap[this.mode].addPoint(n),this.modeMap[this.mode].onMouseDown(n),this.onImageUpdate()):i.type==="handle-in"||i.type==="handle-out"?(this.mode="HANDLE",this.modeMap[this.mode].onMouseDown(n)):(this.mode="FILL",this.modeMap[this.mode].onMouseDown(n))}handleMouseMove(t){const s=this.getHitResult(t.point);let i;if(s){const n=s.item;n.selected?i=null:z.isBoundsItem(n)?i=V.hoverBounds(n):i=V.hoverItem(n)}(!i&&F.currentHoveredItem||i&&!F.currentHoveredItem||i&&F.currentHoveredItem&&i.id!==F.currentHoveredItem.id)&&(F.clearHoveredItem(),F.currentHoveredItem=i??null)}handleMouseDrag(t){t.event.button>0||!this.active||this.modeMap[this.mode].onMouseDrag(t)}handleMouseUp(t){t.event.button>0||!this.active||(this.mode==="SELECTION_BOX"?this.modeMap[this.mode].onMouseUpVector(t):this.modeMap[this.mode].onMouseUp(),this.mode="SELECTION_BOX",this.active=!1)}handleKeyDown(t){if(t.event.target instanceof HTMLInputElement)return;const s=1/a.view.zoom,i=b.getSelectedLeafItems();if(i.length===0)return;let n;if(t.key==="up"?n=new a.Point(0,-s):t.key==="down"?n=new a.Point(0,s):t.key==="left"?n=new a.Point(-s,0):t.key==="right"&&(n=new a.Point(s,0)),n){const r=b.getSelectedSegments();if(r.length===0)for(const l of i)l.translate(n);else for(const l of r)l.point=l.point.add(n)}}handleKeyUp(t){b.getSelectedLeafItems().length!==0&&(t.key==="up"||t.key==="down"||t.key==="left"||t.key==="right")&&this.onImageUpdate()}deactivate(){a.settings.handleSize=0,F.clearHoveredItem()}}class qt extends ${constructor(){super();h(this,"boundingBoxTool");h(this,"selectionBoxTool");h(this,"selectionBoxMode",!1);h(this,"lastEvent");this.boundingBoxTool=new St(this,m.SELECT),this.childTools.push(this.boundingBoxTool),this.selectionBoxTool=new ke(this,m.SELECT);const t=new Bt(this.boundingBoxTool,this.onImageUpdate);this.on("mousedown",this.handleMouseDown),this.on("mousemove",this.handleMouseMove),this.on("mousedrag",this.handleMouseDrag),this.on("mouseup",this.handleMouseUp),this.on("keydown",t.onKeyDown),this.on("keyup",t.onKeyUp),b.selectRootItem(),this.boundingBoxTool.setSelectionBounds()}static get TOLERANCE(){return 2}static get DOUBLE_CLICK_MILLIS(){return 250}deactivate(){this.boundingBoxTool.deactivate(),F.clearHoveredItem()}getHitOptions(t){const s={selected:!1,segments:!0,stroke:!0,curves:!0,fill:!0,guide:!1,tolerance:qt.TOLERANCE/a.view.zoom,match:i=>!i.item.data||!i.item.data.isHelperItem?!0:i.item.data.isScaleHandle||i.item.data.isRotHandle};return t&&(s.selected=!0),s}handleMouseDown(t){if(t.event.button>0)return;this.active=!0,F.clearHoveredItem();let s=!1;this.lastEvent&&(t.event.timeStamp-this.lastEvent.event.timeStamp<qt.DOUBLE_CLICK_MILLIS?s=!0:s=!1),this.lastEvent=t,this.boundingBoxTool.onMouseDown(t,t.modifiers.alt,t.modifiers.shift,s,this.getHitOptions(!1))||(this.selectionBoxMode=!0,this.selectionBoxTool.onMouseDown(t.modifiers.shift))}handleMouseMove(t){const s=F.getHoveredItem(t,this.getHitOptions());(!s&&F.currentHoveredItem||s&&!F.currentHoveredItem||s&&F.currentHoveredItem&&s.id!==F.currentHoveredItem.id)&&(F.clearHoveredItem(),F.currentHoveredItem=s),this.selectionBoxMode||this.boundingBoxTool.onMouseMove(t,this.getHitOptions(!1))}handleMouseDrag(t){t.event.button>0||!this.active||(this.selectionBoxMode?this.selectionBoxTool.onMouseDrag(t):this.boundingBoxTool.onMouseDrag(t))}handleMouseUp(t){t.event.button>0||!this.active||(this.selectionBoxMode?this.selectionBoxTool.onMouseUpVector(t):this.boundingBoxTool.onMouseUp(t,this.getHitOptions(!1)),this.selectionBoxMode=!1,this.active=!1)}}class Le extends ${constructor(){super();h(this,"fillItem",null);h(this,"fillProperty",null);h(this,"addedFillItem",null);h(this,"fillItemOrigColor",null);this.on("mousedown",this.handleMouseDown),this.on("mousemove",this.handleMouseMove),this.on("mouseup",this.handleMouseUp)}static get TOLERANCE(){return 2}get gradientType(){var t;return((t=this.fillColor)==null?void 0:t.gradientType)??O.SOLID}getHitOptions(){const t=function(s){return s instanceof a.Path&&s.segments.length>2&&s.lastSegment.point.getDistance(s.firstSegment.point)<8};return{segments:!1,stroke:!0,curves:!1,fill:!0,guide:!1,match:function(s){const i=s.item.hasFill()||s.item.closed||t(s.item);if(s.item instanceof a.Path&&(i||s.type!=="fill")||s.item instanceof a.PointText)return!0},hitUnfilledPaths:!0,hitUnstrokedPaths:this.gradientType===O.SOLID&&this.fillColor===null,tolerance:Le.TOLERANCE/a.view.zoom}}updateFillPreview(t){var l;const s=F.getHoveredItem(t,this.getHitOptions(),!0);(!s&&F.currentHoveredItem||s&&!F.currentHoveredItem||s&&F.currentHoveredItem&&s.id!==F.currentHoveredItem.id)&&(F.clearHoveredItem(),F.currentHoveredItem=s);const i=s?s.data.origItem:null,n=s?s.data.hitResult.type:null;if(!(i!==this.fillItem||n!==this.fillProperty)){((l=this.fillColor)==null?void 0:l.gradientType)===O.RADIAL&&this._setFillItemColor(this.fillColor.primary,this.fillColor.secondary,this.gradientType,t.point);return}if(this.fillItem&&(this.addedFillItem?(this.addedFillItem.remove(),this.addedFillItem=null):this._setFillItemColor(this.fillItemOrigColor),this.fillItemOrigColor=null,this.fillItem=null,this.fillProperty=null),i){this.fillItem=i,this.fillProperty=n;const u=n==="fill"?"fillColor":"strokeColor";if(this.fillItemOrigColor=i[u],i.parent instanceof a.CompoundPath&&i.area<0&&n==="fill"){if(!this.fillColor){this.fillItem=null,this.fillProperty=null,this.fillItemOrigColor=null;return}this.addedFillItem=i.clone(),this.addedFillItem.setClockwise(!0),this.addedFillItem.data.noHover=!0,this.addedFillItem.data.origItem=i,U.expandBy(this.addedFillItem,.1),this.addedFillItem.insertAbove(i.parent)}else this.fillItem.parent instanceof a.CompoundPath&&(this.fillItemOrigColor=i.parent[u]);this._setFillItemColor(this.fillColor.primary,this.fillColor.secondary,this.gradientType,t.point)}}handleMouseDown(t){this.updateFillPreview(t)}handleMouseMove(t){this.updateFillPreview(t)}handleMouseUp(t){if(!(t.event.button>0)&&this.fillItem){if(this.addedFillItem&&this._noStroke(this.fillItem.parent)&&this.addedFillItem.fillColor.type!=="gradient"&&this.fillItem.parent.fillColor.toCSS()===this.addedFillItem.fillColor.toCSS()){this.addedFillItem.remove(),this.addedFillItem=null;let s=this.fillItem.parent;this.fillItem.remove(),s=s.reduce(),s.fillColor=this.fillColor}else if(this.addedFillItem)this.addedFillItem.data.noHover=!1;else if(!this.fillColor&&this.fillItem.data&&this.fillItem.data.origItem){const s=this.fillItem.parent;this.fillItem.remove(),!(s instanceof a.Layer)&&s.children.length===1&&s.reduce()}F.clearHoveredItem(),this.fillItem=null,this.fillProperty=null,this.addedFillItem=null,this.fillItemOrigColor=null,this.emit("Image")}}_noStroke(t){return!t.strokeColor||t.strokeColor.alpha===0||t.strokeWidth===0}_setFillItemColor(t,s,i,n){const r=this._getFillItem();if(!r)return;const l=this.fillProperty==="fill"?"fillColor":"strokeColor";i&&i!==O.SOLID?r[l]=Ee(t,s,i,r.bounds,n,r.strokeWidth):r[l]=t}_getFillItem(){return this.addedFillItem?this.addedFillItem:this.fillItem&&this.fillItem.parent instanceof a.CompoundPath?this.fillItem.parent:this.fillItem}deactivate(){this.fillItem&&(this._setFillItemColor(this.fillItemOrigColor),this.fillItemOrigColor=null,this.fillItem=null,this.fillProperty=null),F.clearHoveredItem()}}const kt=function(o,e,t){return o.getDistance(e,!0)<Math.pow(t/a.view.zoom,2)},fe=function(o,e,t){const s=b.getItems({class:a.Path});for(let i=s.length-1;i>=0;i--)if(!s[i].closed&&s[i].parent instanceof a.Layer&&!(t&&s[i]===t)){if(s[i].firstSegment&&kt(s[i].firstSegment.point,o,e))return{path:s[i],segment:s[i].firstSegment,isFirst:!0};if(s[i].lastSegment&&kt(s[i].lastSegment.point,o,e))return{path:s[i],segment:s[i].lastSegment,isFirst:!1}}return null},yt=6;class Mn extends ${constructor(){super();h(this,"hitResult",null);h(this,"path",null);h(this,"onMouseDown",t=>{t.event.button>0||(this.active=!0,this.hitResult=fe(t.point,yt),this.hitResult&&(this.path=this.hitResult.path,at(this.path,{fillColor:null,strokeColor:this.strokeColor,strokeWidth:this.strokeWidth}),this.hitResult.isFirst&&this.path.reverse(),this.path.lastSegment.handleOut=null,this.path.add(this.hitResult.segment.point)),this.path||(this.path=new paper.Path,this.path.strokeCap="round",at(this.path,{fillColor:null,strokeColor:this.strokeColor,strokeWidth:this.strokeWidth}),this.path.add(t.point),this.path.add(t.point)))});h(this,"onMouseMove",t=>{this.hitResult&&V.removeHitPoint(),this.hitResult=fe(t.point,yt),this.drawHitPoint(this.hitResult)});h(this,"onMouseDrag",t=>{if(t.event.button>0||!this.active)return;this.hitResult&&(V.removeHitPoint(),this.hitResult=null);let s=t.point;if(t.modifiers.shift){const i=t.point.subtract(this.path.lastSegment.previous.point);s=this.path.lastSegment.previous.point.add(U.snapDeltaToAngle(i,Math.PI/4))}if(this.path&&!this.path.closed&&this.path.segments.length>3&&kt(this.path.firstSegment.point,s,yt)?this.hitResult={path:this.path,segment:this.path.firstSegment,isFirst:!0}:this.hitResult=fe(s,yt,this.path),this.hitResult&&t.modifiers.shift){const i=this.hitResult.segment.point.subtract(this.path.lastSegment.previous.point),n=s.subtract(this.path.lastSegment.previous.point);i.normalize().getDistance(n.normalize())>.01&&(this.hitResult=null)}this.hitResult?(this.drawHitPoint(this.hitResult),this.path.lastSegment.point=this.hitResult.segment.point):this.path.lastSegment.point=s,at(this.path,{fillColor:null,strokeColor:this.strokeColor,strokeWidth:this.strokeWidth})});h(this,"onMouseUp",t=>{if(!(t.event.button>0||!this.active)&&this.path){if(this.path.segments.length<2||this.path.segments.length===2&&kt(this.path.firstSegment.point,t.point,yt)&&!this.hitResult){this.path.remove(),this.path=null;return}else if(!this.hitResult&&kt(this.path.lastSegment.point,this.path.segments[this.path.segments.length-2].point,yt)){this.path.removeSegment(this.path.segments.length-1),this.path=null;return}this.hitResult&&(this.path.removeSegment(this.path.segments.length-1),this.path.firstSegment.point.equals(this.hitResult.segment.point)?(this.path.firstSegment.handleIn=null,this.path.closed=!0):(this.hitResult.isFirst||this.hitResult.path.reverse(),this.hitResult.path.firstSegment.handleIn=null,this.path.join(this.hitResult.path)),V.removeHitPoint(),this.hitResult=null),at(this.path,{fillColor:null,strokeColor:this.strokeColor,strokeWidth:this.strokeWidth}),this.path&&(this.onImageUpdate(),this.path=null),this.active=!1}});h(this,"drawHitPoint",t=>{if(t){const s=t.path;t.isFirst?V.drawHitPoint(s.firstSegment.point):V.drawHitPoint(s.lastSegment.point)}});h(this,"deactivate",()=>{this.remove(),this.hitResult&&(V.removeHitPoint(),this.hitResult=null),this.path&&(this.path=null)});this.on("mousedown",this.onMouseDown),this.on("mousemove",this.onMouseMove),this.on("mousedrag",this.onMouseDrag),this.on("mouseup",this.onMouseUp)}}class Jt extends ${constructor(){super();h(this,"boundingBoxTool");h(this,"oval",null);h(this,"isBoundingBoxMode",null);this.boundingBoxTool=new St(this,m.OVAL),this.childTools.push(this.boundingBoxTool);const t=new Bt(this.boundingBoxTool,this.onImageUpdate,!1);this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag),this.on("mousemove",this.handleMouseMove),this.on("mouseup",this.handleMouseUp),this.on("keydown",t.onKeyDown),this.on("keyup",t.onKeyUp)}static get TOLERANCE(){return 2}getHitOptions(){return{segments:!0,stroke:!0,curves:!0,fill:!0,guide:!1,match:t=>t.item.data&&(t.item.data.isScaleHandle||t.item.data.isRotHandle)||t.item.selected,tolerance:Jt.TOLERANCE/a.view.zoom}}handleMouseDown(t){t.event.button>0||(this.active=!0,this.boundingBoxTool.onMouseDown(t,!1,!1,!1,this.getHitOptions())?this.isBoundingBoxMode=!0:(this.isBoundingBoxMode=!1,b.clearSelection(),this.oval=new a.Shape.Ellipse({point:t.downPoint,size:0}),at(this.oval,this)))}handleMouseDrag(t){if(t.event.button>0||!this.active)return;if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseDrag(t);return}const s=new a.Point(t.downPoint.x,t.downPoint.y),i=new a.Point(t.point.x,t.point.y),n=U.getSquareDimensions(t.downPoint,t.point);t.modifiers.shift?this.oval.size=n.size.abs():this.oval.size=s.subtract(i),t.modifiers.alt?this.oval.position=s:t.modifiers.shift?this.oval.position=n.position:this.oval.position=s.subtract(this.oval.size.multiply(.5)),at(this.oval,this)}handleMouseMove(t){this.boundingBoxTool.onMouseMove(t,this.getHitOptions())}handleMouseUp(t){if(!(t.event.button>0||!this.active)){if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseUp(t),this.isBoundingBoxMode=null;return}if(this.oval)if(Math.abs(this.oval.size.width*this.oval.size.height)<Jt.TOLERANCE/a.view.zoom)this.oval.remove(),this.oval=null;else{const s=this.oval.toPath(!0);this.oval.remove(),this.oval=null,s.selected=!0,this.onImageUpdate()}this.active=!1}}deactivate(){this.boundingBoxTool.deactivate()}}class Qt extends ${constructor(){super();h(this,"boundingBoxTool",new St(this,m.RECT));h(this,"rect",null);h(this,"isBoundingBoxMode",null);this.boundingBoxTool=new St(this,m.RECT),this.childTools.push(this.boundingBoxTool);const t=new Bt(this.boundingBoxTool,this.onImageUpdate,!1);this.on("mousedown",this.handleMouseDown),this.on("mousedrag",this.handleMouseDrag),this.on("mousemove",this.handleMouseMove),this.on("mouseup",this.handleMouseUp),this.on("keydown",t.onKeyDown),this.on("keyup",t.onKeyUp)}static get TOLERANCE(){return 2}getHitOptions(){return{segments:!0,stroke:!0,curves:!0,fill:!0,guide:!1,match:t=>t.item.data&&(t.item.data.isScaleHandle||t.item.data.isRotHandle)||t.item.selected,tolerance:Qt.TOLERANCE/a.view.zoom}}handleMouseDown(t){t.event.button>0||(this.active=!0,this.boundingBoxTool.onMouseDown(t,!1,!1,!1,this.getHitOptions())?this.isBoundingBoxMode=!0:(this.isBoundingBoxMode=!1,b.clearSelection()))}handleMouseDrag(t){if(t.event.button>0||!this.active)return;if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseDrag(t);return}this.rect&&this.rect.remove();const s=new a.Rectangle(t.downPoint,t.point),i=U.getSquareDimensions(t.downPoint,t.point);if(t.modifiers.shift&&(s.size=i.size.abs()),this.rect=new a.Path.Rectangle(s),t.modifiers.alt)this.rect.position=t.downPoint;else if(t.modifiers.shift)this.rect.position=i.position;else{const n=t.point.subtract(t.downPoint);this.rect.position=t.downPoint.add(n.multiply(.5))}at(this.rect,this)}handleMouseUp(t){if(!(t.event.button>0||!this.active)){if(this.isBoundingBoxMode){this.boundingBoxTool.onMouseUp(t),this.isBoundingBoxMode=null;return}this.rect&&(this.rect.area<Qt.TOLERANCE/a.view.zoom?(this.rect.remove(),this.rect=null):(this.rect.selected=!0,this.onImageUpdate(),this.rect=null)),this.active=!1}}handleMouseMove(t){this.boundingBoxTool.onMouseMove(t,this.getHitOptions())}deactivate(){this.boundingBoxTool.deactivate()}}class yn extends zt{constructor(){super(...arguments);h(this,"mode",null);h(this,"currentTool",null);h(this,"setMode",t=>{if(B.toolMode!==t){switch(this.currentTool&&(b.clearSelection(),this.currentTool.deactivate(),this.currentTool.remove(),this.currentTool=null),t){case m.SELECT:this.currentTool=new qt,this.currentTool.activate();break;case m.FILL:this.currentTool=new Le,this.currentTool.activate();break;case m.RESHAPE:this.currentTool=new st,this.currentTool.activate();break;case m.BRUSH:this.currentTool=new $t,this.currentTool.activate();break;case m.ERASER:this.currentTool=new $t(!0),this.currentTool.activate();break;case m.LINE:this.currentTool=new Mn,this.currentTool.activate();break;case m.RECT:this.currentTool=new Qt,this.currentTool.activate();break;case m.OVAL:this.currentTool=new Jt,this.currentTool.activate();break;case m.BIT_SELECT:this.currentTool=new wn,this.currentTool.activate();break;case m.BIT_FILL:this.currentTool=new an,this.currentTool.activate();break;case m.BIT_BRUSH:this.currentTool=new es,this.currentTool.activate();break;case m.BIT_ERASER:this.currentTool=new es(!0),this.currentTool.activate();break;case m.BIT_LINE:this.currentTool=new ln,this.currentTool.activate();break;case m.BIT_OVAL:this.currentTool=new Zt,this.currentTool.activate();break;case m.BIT_RECT:this.currentTool=new Kt,this.currentTool.activate();break}this.currentTool&&this.currentTool.on("Image",()=>{this.emit("Image")}),B.setState({toolMode:t})}});h(this,"handleSwitchToTextTool",()=>{})}dispose(){this.mode=null}}const Rt=new yn;class Rn extends zt{constructor(){super();h(this,"reduxDispatch");h(this,"ViewHelper",Q);h(this,"LayerHelper",S);h(this,"ToolsHelper",Rt);h(this,"UndoHelper",ye);h(this,"GroupHelper",se);h(this,"SvgHelper",Re);h(this,"BitMapHelper",Js);h(this,"store",B);h(this,"canvas");h(this,"onResize",()=>{a.view.on("resize",this.handleResize)});h(this,"offResize",()=>{a.view.off("resize",this.handleResize)});h(this,"syncStore",()=>{this.dispatch(He(B.cursor)),this.dispatch(Ue(B.paintFormat)),this.dispatch(Fe({workspace:Wt(B.workspaceBounds),view:Wt(a.view.bounds)})),this.dispatch(Ne(B.undo)),this.dispatch(Ge(B.toolMode)),this.dispatch(Ve(B.fillColor)),this.dispatch(We(B.strokeColor))});h(this,"onStoreChange",()=>{B.on("change",({key:t,newValue:s})=>{switch(t){case"cursor":this.dispatch(He(s));break;case"paintFormat":this.dispatch(Ue(s));break;case"workspaceBounds":this.dispatch(Fe({workspace:Wt(B.workspaceBounds),view:Wt(a.view.bounds)}));break;case"undo":this.dispatch(Ne(s));break;case"toolMode":this.dispatch(Ge(s));break;case"fillColor":this.dispatch(Ve(s));break;case"strokeColor":this.dispatch(We(s));break;case"brushSize":this.dispatch(jo(s));break;case"eraserSize":this.dispatch(Wo(s));break}})});h(this,"handleResize",()=>{Q.updateWorkspaceBounds(!0),Q.clampViewBounds(),Q.recalibrateSize()});Rt.on("Image",()=>{this.emit("Image")}),this.onStoreChange()}attachDispatch(t){this.reduxDispatch=t}setup(t){if(!t)return;this.canvas=t;const s=t.getContext("2d");s.imageSmoothingEnabled=!1,a.setup(t),a.settings.handleSize=0,Q.resetZoom(),S.setupLayers(B.paintFormat),Rt.setMode(Yt(B.paintFormat)?m.SELECT:m.BIT_SELECT),this.syncStore(),this.onResize(),this.emit("Mount",{canvas:this.canvas})}dispose(){Rt.dispose(),this.offResize(),a.remove(),this.emit("Unmount")}clear(){S.clear(),ye.clear()}setFormat(t){B.paintFormat!==t&&(B.setState({paintFormat:t}),this.switchToolModeByFormat(t))}whenMounted(){return this.canvas?Promise.resolve({canvas:this.canvas}):this.waitFor("Mount")}whenUnmounted(){return this.waitFor("Unmount")}switchToolModeByFormat(t){const i={[m.BRUSH]:m.BIT_BRUSH,[m.ERASER]:m.BIT_ERASER,[m.LINE]:m.BIT_LINE,[m.FILL]:m.BIT_FILL,[m.SELECT]:m.BIT_SELECT,[m.OVAL]:m.BIT_OVAL,[m.RECT]:m.BIT_RECT,[m.TEXT]:m.BIT_TEXT,[m.RESHAPE]:m.BIT_SELECT,[m.ROUNDED_RECT]:m.BIT_RECT,[m.BIT_BRUSH]:m.BRUSH,[m.BIT_ERASER]:m.ERASER,[m.BIT_LINE]:m.LINE,[m.BIT_FILL]:m.FILL,[m.BIT_SELECT]:m.SELECT,[m.BIT_OVAL]:m.OVAL,[m.BIT_RECT]:m.RECT,[m.BIT_TEXT]:m.TEXT}[B.toolMode];Yt(t)?Rt.setMode(i??m.SELECT):Rt.setMode(i??m.BIT_SELECT)}dispatch(t){this.reduxDispatch&&this.reduxDispatch(t)}}const M=new Rn,xn=v.forwardRef(({cursor:o,sx:e,...t},s)=>d(it,{component:"canvas",resize:"true",ref:s,sx:{left:1,top:1,width:"calc(100% - 2px)",height:"calc(100% - 2px)",m:"auto",position:"absolute",cursor:o,...e},...t})),Tn=v.memo(v.forwardRef((o,e)=>{const t=_o(),s=v.useRef(null);return v.useImperativeHandle(e,()=>s.current),d(xn,{ref:s,cursor:t})})),Pn=({xDisplay:o,yDisplay:e,offsetX:t,offsetY:s,xBarSize:i,yBarSize:n,onMouseDownX:r,onMouseDownY:l})=>H(Pt,{children:[d(it,{sx:{position:"absolute",left:0,bottom:0,width:"100%",height:0,display:o?"block":"none"},children:d(it,{sx:{position:"absolute",left:t,top:0,width:i,height:12,borderRadius:6,backgroundColor:u=>u.palette.neutral[300],opacity:.7,cursor:"pointer",transform:"translate(0, -100%)"},onMouseDown:r,onTouchStart:r})}),d(it,{sx:{position:"absolute",top:0,right:0,width:0,height:"100%",display:e?"block":"none"},children:d(it,{sx:{position:"absolute",left:0,top:s,width:12,borderRadius:6,height:n,backgroundColor:u=>u.palette.neutral[300],opacity:.7,cursor:"pointer",transform:"translate(-100%, 0)"},onMouseDown:l,onTouchStart:l})})]}),Bn=v.memo(()=>{const{view:o,workspace:e}=Xo(),t=Math.round(o.width*M.ViewHelper.getZoom()),s=Math.round(o.height*M.ViewHelper.getZoom()),i=Math.round(o.width/e.width*t),n=Math.round(o.height/e.height*s),r=t-i,l=s-n,[u,c]=v.useState(0),[f,g]=v.useState(0);v.useLayoutEffect(()=>{const R=o.x/e.width*t,I=o.y/e.height*s;c(R),g(I)},[o,e,t,s]);const C=ot(R=>{if(r<=0||isNaN(r))return;const I=Ce(e.x-3,r+3,R);c(I),M.ViewHelper.setTx(-I*e.width/o.width)}),w=ot(R=>{if(l<=0||isNaN(l))return;const I=Ce(e.y-3,l+3,R);g(I),M.ViewHelper.setTy(-I*e.height/o.height)}),y=ot(R=>{C(u+R)}),L=ot(R=>{w(f+R)}),x=ot((R,I)=>{const P=je(R.nativeEvent),E=I==="x"?P.x:P.y,k=_=>{_.preventDefault();const Y=je(_),Mt=I==="x"?Y.x:Y.y;I==="x"?C(u+Mt-E):w(f+Mt-E)},N=()=>{window.removeEventListener("mousemove",k),window.removeEventListener("touchmove",k),window.removeEventListener("mouseup",N)};window.addEventListener("mousemove",k),window.addEventListener("touchmove",k,{passive:!1}),window.addEventListener("mouseup",N),window.addEventListener("touchend",N)}),T=ot(R=>{x(R,"x")}),A=ot(R=>{x(R,"y")});return v.useEffect(()=>{M.whenMounted().then(({canvas:R})=>{const I=P=>{const E=P.deltaMode===1?15:1;if(P.metaKey||P.ctrlKey){const k=R.getBoundingClientRect(),N=P.clientX-k.left,_=P.clientY-k.top,Y=M.ViewHelper.viewToProject(N,_),Mt=P.deltaY*E;M.ViewHelper.zoomOnFixedPoint(-Mt/1e3,Y)}else if(P.shiftKey){const k=P.deltaX*E/M.ViewHelper.getZoom();y(k)}else{const k=P.deltaY*E/M.ViewHelper.getZoom();L(k)}P.preventDefault()};R.addEventListener("wheel",I),M.whenUnmounted().then(()=>{R.removeEventListener("wheel",I)})})},[y,L]),d(Pn,{xDisplay:r>0,yDisplay:l>0,offsetX:u,offsetY:f,xBarSize:i,yBarSize:n,onMouseDownX:T,onMouseDownY:A})}),eo=o=>H(It,{viewBox:"0 0 511.965 511.965",...o,children:[d("polyline",{style:{fill:"#FFC10D"},points:"43.091,490.355 10.001,501.963 67.701,337.489 174.476,444.264 101.294,469.937    85.551,475.46  "}),d("path",{style:{fill:"#FFC10D"},d:"M482.035,136.704c26.621-26.621,26.621-69.782,0-96.403L471.664,29.93   c-26.621-26.621-69.782-26.621-96.403,0l-15.844,15.844l106.774,106.774L482.035,136.704z"}),d("rect",{x:"60.866",y:"169.438",transform:"matrix(-0.7071 0.7071 -0.7071 -0.7071 629.0347 229.3222)",style:{fill:"#50A5DC"},width:"412.315",height:"151.001"}),H("g",{children:[d("path",{d:"M489.107,33.23l-10.371-10.372c-30.479-30.476-80.067-30.479-110.546,0l-15.845,15.844L60.791,330.256    c-0.097,0.097-0.181,0.202-0.273,0.303c-0.984,1.02-1.769,2.24-2.253,3.62l-57.7,164.475c-1.273,3.627-0.353,7.664,2.365,10.382    c1.908,1.907,4.464,2.929,7.073,2.929c1.108,0,2.227-0.185,3.309-0.564l33.089-11.61c5.211-1.828,7.954-7.535,6.125-12.747    c-1.828-5.211-7.534-7.954-12.747-6.125l-13.455,4.72l45.548-129.836l84.288,84.288l-73.921,25.933    c-5.211,1.828-7.954,7.535-6.125,12.747s7.535,7.957,12.747,6.125l88.925-31.196c1.376-0.483,2.593-1.264,3.611-2.245    c0.103-0.095,0.212-0.182,0.311-0.282l291.548-291.549c0.002-0.002,0.003-0.003,0.005-0.005l15.845-15.844    C519.584,113.298,519.584,63.707,489.107,33.23z M359.416,59.916l92.633,92.633L174.638,429.96l-92.633-92.633L359.416,59.916z    M474.964,129.633l-8.773,8.773L419.875,92.09l-46.316-46.316L382.332,37c22.679-22.68,59.582-22.68,82.261,0l10.371,10.372    C497.644,70.051,497.644,106.954,474.964,129.633z"}),d("path",{d:"M315.68,159.959c-3.906-3.905-10.236-3.904-14.143,0L133.297,328.2c-3.905,3.905-3.905,10.237,0,14.143    c1.953,1.953,4.512,2.929,7.071,2.929s5.119-0.976,7.071-2.929l168.24-168.241C319.585,170.197,319.585,163.865,315.68,159.959z"}),d("path",{d:"M342.066,143.574c2.559,0,5.118-0.977,7.071-2.929l16.251-16.25c3.905-3.905,3.905-10.237,0-14.142    c-3.904-3.905-10.234-3.905-14.143,0l-16.251,16.25c-3.905,3.905-3.905,10.237,0,14.142    C336.948,142.598,339.506,143.574,342.066,143.574z"})]})]}),pt=({isActived:o,...e})=>d(ct,{"aria-label":"tool button",color:"primary",variant:o?"soft":"outlined",...e,children:e.children}),so=o=>d(pt,{...o,children:d(eo,{})}),as=v.memo(()=>{const e=j()===m.BIT_BRUSH;return d(so,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.BIT_BRUSH)},children:d(ii,{})})}),oo=o=>H(It,{viewBox:"0 0 392.509 392.509",...o,children:[d("path",{style:{fill:"#56ACE0"},d:"M172.865,353.735l27.604-27.604L78.352,204.078l-51.717,51.717c-6.465,6.465-6.465,17.002,0,23.467 l74.473,74.473c3.168,3.168,7.37,4.848,11.766,4.848h48.226C165.495,358.583,169.697,356.838,172.865,353.735z"}),d("path",{style:{fill:"#FFFFFF"},d:"M267.248,38.518c-6.271-6.271-17.261-6.271-23.467,0L93.802,188.563L215.919,310.68l149.98-149.98 c6.465-6.465,6.465-17.002,0-23.467L267.248,38.518z"}),d("path",{style:{fill:"#FFC10D"},d:"M255.547,57.654l-10.343,10.343l32.194,32.194c4.267,4.267,4.267,11.119,0,15.451 c-3.038,3.038-11.766,3.62-15.451,0l-32.129-32.194l-20.687,20.687l10.796,10.796c4.267,4.267,4.267,11.119,0,15.45 c-3.943,3.943-12.412,2.909-15.451,0l-10.796-10.796l-69.042,69.042l91.281,91.281l130.909-130.909L255.547,57.654z"}),d("path",{style:{fill:"#194F82"},d:"M381.349,121.783l-98.586-98.586c-15.321-15.192-40.016-14.287-54.303,0L11.248,240.28 c-14.998,14.998-14.998,39.305,0,54.303l74.473,74.473c7.24,7.24,16.937,11.313,27.216,11.313h48.226 c10.279,0,19.911-4.008,27.216-11.313l193.034-193.034C396.218,161.153,396.218,136.781,381.349,121.783z M172.865,353.735 c-3.103,3.103-7.37,4.848-11.766,4.848h-48.226c-4.396,0-8.663-1.745-11.766-4.848l-74.473-74.473 c-6.271-6.206-6.594-16.937,0-23.467l51.717-51.717l122.117,122.117L172.865,353.735z M365.899,160.7l-149.98,149.98L93.802,188.628 l149.98-149.98c5.883-6.206,16.937-6.659,23.467,0l98.586,98.586C372.364,143.634,372.364,154.236,365.899,160.7z"})]}),io=o=>d(pt,{...o,children:d(oo,{})}),ls=v.memo(()=>{const e=j()===m.BIT_ERASER;return d(io,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.BIT_ERASER)}})}),no=o=>d(pt,{...o,children:H(It,{viewBox:"1 1 24 24",children:[d("path",{d:"M16.56 8.94 7.62 0 6.21 1.41l2.38 2.38-5.15 5.15c-.59.59-.59 1.54 0 2.12l5.5 5.5c.29.29.68.44 1.06.44s.77-.15 1.06-.44l5.5-5.5c.59-.58.59-1.53 0-2.12z"}),d("path",{style:{fill:"#50A5DC"},d:"M5.21 10 10 5.21 14.79 10H5.21z"}),d("path",{style:{fill:"#50A5DC"},d:"M19 11.5s-2 2.17-2 3.5c0 1.1.9 2 2 2s2-.9 2-2c0-1.33-2-3.5-2-3.5z"}),d("path",{style:{fill:"#FFC10D"},d:"M2 20h20v4H2v-4z"})]})}),hs=v.memo(()=>{const o=j();return d(no,{isActived:o===m.BIT_FILL,onClick:()=>{M.ToolsHelper.setMode(m.BIT_FILL)}})}),ro=o=>d(pt,{...o,children:d(ni,{sx:{transform:"rotate(-45deg)"}})}),cs=v.memo(()=>{const e=j()===m.BIT_LINE;return d(ro,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.BIT_LINE)}})}),ao=o=>d(pt,{...o,children:H(It,{children:[d("circle",{style:{fill:"#FFC10D"},cx:"12",cy:"12",r:"8"}),d("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})]})}),us=v.memo(()=>{const e=j()===m.BIT_OVAL;return d(ao,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.BIT_OVAL)}})}),lo=o=>d(pt,{...o,children:H(It,{children:[d("path",{style:{fill:"#50A5DC"},d:"M4 6h16v12H4z"}),d("path",{d:"M2 4v16h20V4H2zm18 14H4V6h16v12z"})]})}),ds=v.memo(()=>{const e=j()===m.BIT_RECT;return d(lo,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.BIT_RECT)}})}),ho=({...o})=>d(pt,{...o,children:H(It,{viewBox:"0 0 512 512",children:[d("path",{style:{fill:"#50A5DC"},d:"M298.882,342.581l123.333,0.023L175.737,96.127l0.544,342.962l82.69-80.275l52.62,129.735   c3.396,8.373,11.459,13.452,19.971,13.452c2.696,0,5.437-0.51,8.09-1.585c11.025-4.472,16.338-17.035,11.866-28.06L298.882,342.581   z"}),d("path",{d:"M205.757,218.32c-5.523,0-10-4.477-10-10v-26.398c0-5.523,4.477-10,10-10s10,4.477,10,10v26.398   C215.757,213.843,211.28,218.32,205.757,218.32z"}),d("path",{d:"M128,168.398c-5.523,0-10-4.477-10-10V132c0-5.523,4.477-10,10-10s10,4.477,10,10v26.398   C138,163.921,133.523,168.398,128,168.398z"}),d("path",{d:"M239.398,60H213c-5.523,0-10-4.477-10-10s4.477-10,10-10h26.398c5.523,0,10,4.477,10,10S244.921,60,239.398,60z"}),d("path",{d:"M205.757,371.759c-5.523,0-10-4.477-10-10V249.567c0-5.523,4.477-10,10-10s10,4.477,10,10v112.192   C215.757,367.282,211.28,371.759,205.757,371.759z"}),d("rect",{x:"89.786",y:"10",style:{fill:"#FFC10D"},width:"86.127",height:"86.127"}),d("path",{d:"M429.286,335.533L185.913,92.16V10c0-5.523-4.477-10-10-10H89.786c-5.523,0-10,4.477-10,10v86.127c0,5.523,4.477,10,10,10   h75.967l0.528,332.978c0.006,4.015,2.413,7.637,6.112,9.198c3.698,1.561,7.973,0.758,10.853-2.038l72.038-69.935l47.04,115.977   C307.176,504.27,318.652,512,331.561,512c4.069,0,8.055-0.78,11.848-2.318c7.808-3.167,13.915-9.185,17.197-16.945   c3.282-7.76,3.345-16.333,0.178-24.141L313.73,352.584l108.482,0.02c0.001,0,0.001,0,0.001,0c4.044,0,7.691-2.436,9.239-6.172   C433.001,342.695,432.145,338.394,429.286,335.533z M99.786,20h66.127v66.127H99.786V20z M298.884,332.582   c-0.001,0-0.001,0-0.002,0c-3.326,0-6.435,1.654-8.293,4.413c-1.859,2.759-2.224,6.262-0.973,9.346l52.635,129.772   c1.159,2.857,1.136,5.995-0.065,8.834c-1.201,2.839-3.436,5.042-6.293,6.201c-1.394,0.565-2.851,0.852-4.331,0.852   c-4.726,0-8.927-2.83-10.704-7.21l-52.62-129.734c-1.25-3.083-3.952-5.342-7.207-6.027c-0.685-0.144-1.374-0.214-2.06-0.214   c-2.574,0-5.081,0.995-6.965,2.825l-65.762,63.842l-0.468-295.172L398.068,332.6L298.884,332.582z"})]})}),fs=v.memo(()=>{const o=j();return d(ho,{isActived:o===m.BIT_SELECT,onClick:()=>{M.ToolsHelper.setMode(m.BIT_SELECT)}})}),co=({onGlobalWheel:o,...e})=>(v.useEffect(()=>{if(o){const t=s=>{const i=e.min??-1/0,n=e.max??1/0,r=e.value??0,l=s.deltaY<0?-1:1;o(s,Ce(i,n,r+l))};return window.addEventListener("wheel",t),()=>{window.removeEventListener("wheel",t)}}},[o,e.max,e.min,e.value]),d(ri,{...e})),En=1,kn=100,Ln=v.memo(()=>{const o=v.useId(),e=Yo(),[t,s]=v.useState(null),i=r=>{s(r)};return H(Pt,{children:[d(Ds,{startDecorator:d(eo,{sx:{fontSize:16}}),onClick:r=>{i(r.currentTarget)},onFocus:r=>{r.preventDefault()},value:e,slotProps:{input:{sx:{textAlign:"end"}}}}),d(ee,{id:o,open:!!t,anchor:t,offset:8,placement:"right",children:d(te,{onClickAway:()=>{s(null)},touchEvent:"onTouchEnd",children:d(Os,{sx:{height:300,boxShadow:"xl"},children:d(co,{orientation:"vertical",value:M.store.brushSize,min:En,max:kn,valueLabelDisplay:"on",onChange:(r,l)=>{M.store.setState({brushSize:l})},onGlobalWheel:(r,l)=>{M.store.setState({brushSize:l})}})})})})]})}),ms=v.memo(()=>{const o=j();return d(so,{isActived:o===m.BRUSH,onClick:()=>{M.ToolsHelper.setMode(m.BRUSH)}})}),An=v.memo(()=>{const o=v.useId(),e=Zo(),[t,s]=v.useState(null),i=r=>{s(r)};return H(Pt,{children:[d(Ds,{startDecorator:d(oo,{sx:{fontSize:16}}),onClick:r=>{i(r.currentTarget)},value:e,slotProps:{input:{sx:{textAlign:"end"}}}}),d(ee,{id:o,open:!!t,anchor:t,offset:8,placement:"right",withTransition:!0,children:d(te,{onClickAway:()=>{s(null)},touchEvent:"onTouchStart",children:d(Os,{sx:{height:300,boxShadow:"xl"},children:d(co,{orientation:"vertical",value:M.store.eraserSize,min:1,max:100,valueLabelDisplay:"on",onChange:(r,l)=>{M.store.setState({eraserSize:l})},onGlobalWheel:(r,l)=>{M.store.setState({eraserSize:l})}})})})})]})}),gs=v.memo(()=>{const e=j()===m.ERASER;return d(io,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.ERASER)}})}),Dn="/assets/alpha-o0W21C3B.svg",lt=v.forwardRef(({color:o,secondaryColor:e,gradientType:t=O.SOLID,...s},i)=>{o=o??"transparent",e=e??"transparent";let n="none";return t===O.SOLID?n=`linear-gradient(to right, ${o}, ${o})`:t===O.HORIZONTAL?n=`linear-gradient(to right, ${o}, ${e})`:t===O.VERTICAL?n=`linear-gradient(to bottom, ${o}, ${e})`:t===O.RADIAL&&(n=`radial-gradient(${o}, ${e})`),d(ct,{...s,"aria-label":"color block",ref:i,variant:"outlined",sx:{overflow:"hidden",backgroundImage:`url(${Dn})`,":before":{content:'""',display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundImage:n},...s.sx}})});function W(o,e){On(o)&&(o="100%");var t=zn(o);return o=e===360?o:Math.min(e,Math.max(0,parseFloat(o))),t&&(o=parseInt(String(o*e),10)/100),Math.abs(o-e)<1e-6?1:(e===360?o=(o<0?o%e+e:o%e)/parseFloat(String(e)):o=o%e/parseFloat(String(e)),o)}function jt(o){return Math.min(1,Math.max(0,o))}function On(o){return typeof o=="string"&&o.indexOf(".")!==-1&&parseFloat(o)===1}function zn(o){return typeof o=="string"&&o.indexOf("%")!==-1}function uo(o){return o=parseFloat(o),(isNaN(o)||o<0||o>1)&&(o=1),o}function _t(o){return o<=1?"".concat(Number(o)*100,"%"):o}function vt(o){return o.length===1?"0"+o:String(o)}function Hn(o,e,t){return{r:W(o,255)*255,g:W(e,255)*255,b:W(t,255)*255}}function ps(o,e,t){o=W(o,255),e=W(e,255),t=W(t,255);var s=Math.max(o,e,t),i=Math.min(o,e,t),n=0,r=0,l=(s+i)/2;if(s===i)r=0,n=0;else{var u=s-i;switch(r=l>.5?u/(2-s-i):u/(s+i),s){case o:n=(e-t)/u+(e<t?6:0);break;case e:n=(t-o)/u+2;break;case t:n=(o-e)/u+4;break}n/=6}return{h:n,s:r,l}}function me(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*(6*t):t<1/2?e:t<2/3?o+(e-o)*(2/3-t)*6:o}function Un(o,e,t){var s,i,n;if(o=W(o,360),e=W(e,100),t=W(t,100),e===0)i=t,n=t,s=t;else{var r=t<.5?t*(1+e):t+e-t*e,l=2*t-r;s=me(l,r,o+1/3),i=me(l,r,o),n=me(l,r,o-1/3)}return{r:s*255,g:i*255,b:n*255}}function vs(o,e,t){o=W(o,255),e=W(e,255),t=W(t,255);var s=Math.max(o,e,t),i=Math.min(o,e,t),n=0,r=s,l=s-i,u=s===0?0:l/s;if(s===i)n=0;else{switch(s){case o:n=(e-t)/l+(e<t?6:0);break;case e:n=(t-o)/l+2;break;case t:n=(o-e)/l+4;break}n/=6}return{h:n,s:u,v:r}}function Fn(o,e,t){o=W(o,360)*6,e=W(e,100),t=W(t,100);var s=Math.floor(o),i=o-s,n=t*(1-e),r=t*(1-i*e),l=t*(1-(1-i)*e),u=s%6,c=[t,r,n,n,l,t][u],f=[l,t,t,r,n,n][u],g=[n,n,l,t,t,r][u];return{r:c*255,g:f*255,b:g*255}}function ws(o,e,t,s){var i=[vt(Math.round(o).toString(16)),vt(Math.round(e).toString(16)),vt(Math.round(t).toString(16))];return s&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Nn(o,e,t,s,i){var n=[vt(Math.round(o).toString(16)),vt(Math.round(e).toString(16)),vt(Math.round(t).toString(16)),vt(Gn(s))];return i&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))&&n[3].startsWith(n[3].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}function Gn(o){return Math.round(parseFloat(o)*255).toString(16)}function Cs(o){return Z(o)/255}function Z(o){return parseInt(o,16)}function Vn(o){return{r:o>>16,g:(o&65280)>>8,b:o&255}}var xe={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Wn(o){var e={r:0,g:0,b:0},t=1,s=null,i=null,n=null,r=!1,l=!1;return typeof o=="string"&&(o=Xn(o)),typeof o=="object"&&(nt(o.r)&&nt(o.g)&&nt(o.b)?(e=Hn(o.r,o.g,o.b),r=!0,l=String(o.r).substr(-1)==="%"?"prgb":"rgb"):nt(o.h)&&nt(o.s)&&nt(o.v)?(s=_t(o.s),i=_t(o.v),e=Fn(o.h,s,i),r=!0,l="hsv"):nt(o.h)&&nt(o.s)&&nt(o.l)&&(s=_t(o.s),n=_t(o.l),e=Un(o.h,s,n),r=!0,l="hsl"),Object.prototype.hasOwnProperty.call(o,"a")&&(t=o.a)),t=uo(t),{ok:r,format:o.format||l,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}var jn="[-\\+]?\\d+%?",_n="[-\\+]?\\d*\\.\\d+%?",mt="(?:".concat(_n,")|(?:").concat(jn,")"),ge="[\\s|\\(]+(".concat(mt,")[,|\\s]+(").concat(mt,")[,|\\s]+(").concat(mt,")\\s*\\)?"),pe="[\\s|\\(]+(".concat(mt,")[,|\\s]+(").concat(mt,")[,|\\s]+(").concat(mt,")[,|\\s]+(").concat(mt,")\\s*\\)?"),J={CSS_UNIT:new RegExp(mt),rgb:new RegExp("rgb"+ge),rgba:new RegExp("rgba"+pe),hsl:new RegExp("hsl"+ge),hsla:new RegExp("hsla"+pe),hsv:new RegExp("hsv"+ge),hsva:new RegExp("hsva"+pe),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Xn(o){if(o=o.trim().toLowerCase(),o.length===0)return!1;var e=!1;if(xe[o])o=xe[o],e=!0;else if(o==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t=J.rgb.exec(o);return t?{r:t[1],g:t[2],b:t[3]}:(t=J.rgba.exec(o),t?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=J.hsl.exec(o),t?{h:t[1],s:t[2],l:t[3]}:(t=J.hsla.exec(o),t?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=J.hsv.exec(o),t?{h:t[1],s:t[2],v:t[3]}:(t=J.hsva.exec(o),t?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=J.hex8.exec(o),t?{r:Z(t[1]),g:Z(t[2]),b:Z(t[3]),a:Cs(t[4]),format:e?"name":"hex8"}:(t=J.hex6.exec(o),t?{r:Z(t[1]),g:Z(t[2]),b:Z(t[3]),format:e?"name":"hex"}:(t=J.hex4.exec(o),t?{r:Z(t[1]+t[1]),g:Z(t[2]+t[2]),b:Z(t[3]+t[3]),a:Cs(t[4]+t[4]),format:e?"name":"hex8"}:(t=J.hex3.exec(o),t?{r:Z(t[1]+t[1]),g:Z(t[2]+t[2]),b:Z(t[3]+t[3]),format:e?"name":"hex"}:!1)))))))))}function nt(o){return!!J.CSS_UNIT.exec(String(o))}var Yn=function(){function o(e,t){e===void 0&&(e=""),t===void 0&&(t={});var s;if(e instanceof o)return e;typeof e=="number"&&(e=Vn(e)),this.originalInput=e;var i=Wn(e);this.originalInput=e,this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a,this.roundA=Math.round(100*this.a)/100,this.format=(s=t.format)!==null&&s!==void 0?s:i.format,this.gradientType=t.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=i.ok}return o.prototype.isDark=function(){return this.getBrightness()<128},o.prototype.isLight=function(){return!this.isDark()},o.prototype.getBrightness=function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},o.prototype.getLuminance=function(){var e=this.toRgb(),t,s,i,n=e.r/255,r=e.g/255,l=e.b/255;return n<=.03928?t=n/12.92:t=Math.pow((n+.055)/1.055,2.4),r<=.03928?s=r/12.92:s=Math.pow((r+.055)/1.055,2.4),l<=.03928?i=l/12.92:i=Math.pow((l+.055)/1.055,2.4),.2126*t+.7152*s+.0722*i},o.prototype.getAlpha=function(){return this.a},o.prototype.setAlpha=function(e){return this.a=uo(e),this.roundA=Math.round(100*this.a)/100,this},o.prototype.isMonochrome=function(){var e=this.toHsl().s;return e===0},o.prototype.toHsv=function(){var e=vs(this.r,this.g,this.b);return{h:e.h*360,s:e.s,v:e.v,a:this.a}},o.prototype.toHsvString=function(){var e=vs(this.r,this.g,this.b),t=Math.round(e.h*360),s=Math.round(e.s*100),i=Math.round(e.v*100);return this.a===1?"hsv(".concat(t,", ").concat(s,"%, ").concat(i,"%)"):"hsva(".concat(t,", ").concat(s,"%, ").concat(i,"%, ").concat(this.roundA,")")},o.prototype.toHsl=function(){var e=ps(this.r,this.g,this.b);return{h:e.h*360,s:e.s,l:e.l,a:this.a}},o.prototype.toHslString=function(){var e=ps(this.r,this.g,this.b),t=Math.round(e.h*360),s=Math.round(e.s*100),i=Math.round(e.l*100);return this.a===1?"hsl(".concat(t,", ").concat(s,"%, ").concat(i,"%)"):"hsla(".concat(t,", ").concat(s,"%, ").concat(i,"%, ").concat(this.roundA,")")},o.prototype.toHex=function(e){return e===void 0&&(e=!1),ws(this.r,this.g,this.b,e)},o.prototype.toHexString=function(e){return e===void 0&&(e=!1),"#"+this.toHex(e)},o.prototype.toHex8=function(e){return e===void 0&&(e=!1),Nn(this.r,this.g,this.b,this.a,e)},o.prototype.toHex8String=function(e){return e===void 0&&(e=!1),"#"+this.toHex8(e)},o.prototype.toHexShortString=function(e){return e===void 0&&(e=!1),this.a===1?this.toHexString(e):this.toHex8String(e)},o.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},o.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),s=Math.round(this.b);return this.a===1?"rgb(".concat(e,", ").concat(t,", ").concat(s,")"):"rgba(".concat(e,", ").concat(t,", ").concat(s,", ").concat(this.roundA,")")},o.prototype.toPercentageRgb=function(){var e=function(t){return"".concat(Math.round(W(t,255)*100),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},o.prototype.toPercentageRgbString=function(){var e=function(t){return Math.round(W(t,255)*100)};return this.a===1?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},o.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var e="#"+ws(this.r,this.g,this.b,!1),t=0,s=Object.entries(xe);t<s.length;t++){var i=s[t],n=i[0],r=i[1];if(e===r)return n}return!1},o.prototype.toString=function(e){var t=!!e;e=e??this.format;var s=!1,i=this.a<1&&this.a>=0,n=!t&&i&&(e.startsWith("hex")||e==="name");return n?e==="name"&&this.a===0?this.toName():this.toRgbString():(e==="rgb"&&(s=this.toRgbString()),e==="prgb"&&(s=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(s=this.toHexString()),e==="hex3"&&(s=this.toHexString(!0)),e==="hex4"&&(s=this.toHex8String(!0)),e==="hex8"&&(s=this.toHex8String()),e==="name"&&(s=this.toName()),e==="hsl"&&(s=this.toHslString()),e==="hsv"&&(s=this.toHsvString()),s||this.toHexString())},o.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},o.prototype.clone=function(){return new o(this.toString())},o.prototype.lighten=function(e){e===void 0&&(e=10);var t=this.toHsl();return t.l+=e/100,t.l=jt(t.l),new o(t)},o.prototype.brighten=function(e){e===void 0&&(e=10);var t=this.toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),new o(t)},o.prototype.darken=function(e){e===void 0&&(e=10);var t=this.toHsl();return t.l-=e/100,t.l=jt(t.l),new o(t)},o.prototype.tint=function(e){return e===void 0&&(e=10),this.mix("white",e)},o.prototype.shade=function(e){return e===void 0&&(e=10),this.mix("black",e)},o.prototype.desaturate=function(e){e===void 0&&(e=10);var t=this.toHsl();return t.s-=e/100,t.s=jt(t.s),new o(t)},o.prototype.saturate=function(e){e===void 0&&(e=10);var t=this.toHsl();return t.s+=e/100,t.s=jt(t.s),new o(t)},o.prototype.greyscale=function(){return this.desaturate(100)},o.prototype.spin=function(e){var t=this.toHsl(),s=(t.h+e)%360;return t.h=s<0?360+s:s,new o(t)},o.prototype.mix=function(e,t){t===void 0&&(t=50);var s=this.toRgb(),i=new o(e).toRgb(),n=t/100,r={r:(i.r-s.r)*n+s.r,g:(i.g-s.g)*n+s.g,b:(i.b-s.b)*n+s.b,a:(i.a-s.a)*n+s.a};return new o(r)},o.prototype.analogous=function(e,t){e===void 0&&(e=6),t===void 0&&(t=30);var s=this.toHsl(),i=360/t,n=[this];for(s.h=(s.h-(i*e>>1)+720)%360;--e;)s.h=(s.h+i)%360,n.push(new o(s));return n},o.prototype.complement=function(){var e=this.toHsl();return e.h=(e.h+180)%360,new o(e)},o.prototype.monochromatic=function(e){e===void 0&&(e=6);for(var t=this.toHsv(),s=t.h,i=t.s,n=t.v,r=[],l=1/e;e--;)r.push(new o({h:s,s:i,v:n})),n=(n+l)%1;return r},o.prototype.splitcomplement=function(){var e=this.toHsl(),t=e.h;return[this,new o({h:(t+72)%360,s:e.s,l:e.l}),new o({h:(t+216)%360,s:e.s,l:e.l})]},o.prototype.onBackground=function(e){var t=this.toRgb(),s=new o(e).toRgb(),i=t.a+s.a*(1-t.a);return new o({r:(t.r*t.a+s.r*s.a*(1-t.a))/i,g:(t.g*t.a+s.g*s.a*(1-t.a))/i,b:(t.b*t.a+s.b*s.a*(1-t.a))/i,a:i})},o.prototype.triad=function(){return this.polyad(3)},o.prototype.tetrad=function(){return this.polyad(4)},o.prototype.polyad=function(e){for(var t=this.toHsl(),s=t.h,i=[this],n=360/e,r=1;r<e;r++)i.push(new o({h:(s+r*n)%360,s:t.s,l:t.l}));return i},o.prototype.equals=function(e){return this.toRgbString()===new o(e).toRgbString()},o}(),Zn=["b"],Kn=["v"],ve=function(e){return Math.round(Number(e||0))},$n=function(e){if(e&&Es(e)==="object"&&"h"in e&&"b"in e){var t=e,s=t.b,i=ks(t,Zn);return rt(rt({},i),{},{v:s})}return typeof e=="string"&&/hsb/.test(e)?e.replace(/hsb/,"hsv"):e},Lt=function(o){Ko(t,o);var e=$o(t);function t(s){return qo(this,t),e.call(this,$n(s))}return Jo(t,[{key:"toHsbString",value:function(){var i=this.toHsb(),n=ve(i.s*100),r=ve(i.b*100),l=ve(i.h),u=i.a,c="hsb(".concat(l,", ").concat(n,"%, ").concat(r,"%)"),f="hsba(".concat(l,", ").concat(n,"%, ").concat(r,"%, ").concat(u.toFixed(u===0?0:2),")");return u===1?c:f}},{key:"toHsb",value:function(){var i=this.toHsv();Es(this.originalInput)==="object"&&this.originalInput&&"h"in this.originalInput&&(i=this.originalInput);var n=i;n.v;var r=ks(n,Kn);return rt(rt({},r),{},{b:i.v})}}]),t}(Yn),qn="rc-color-picker",gt=function(e){return e instanceof Lt?e:new Lt(e)},Jn=gt("#1677ff"),fo=function(e){var t=e.offset,s=e.targetRef,i=e.containerRef,n=e.color,r=e.type,l=i.current.getBoundingClientRect(),u=l.width,c=l.height,f=s.current.getBoundingClientRect(),g=f.width,C=f.height,w=g/2,y=C/2,L=(t.x+w)/u,x=1-(t.y+y)/c,T=n.toHsb(),A=L,R=(t.x+w)/u*360;if(r)switch(r){case"hue":return gt(rt(rt({},T),{},{h:R<=0?0:R}));case"alpha":return gt(rt(rt({},T),{},{a:A<=0?0:A}))}return gt({h:T.h,s:L<=0?0:L,b:x>=1?1:x,a:T.a})},mo=function(e,t,s,i){var n=e.current.getBoundingClientRect(),r=n.width,l=n.height,u=t.current.getBoundingClientRect(),c=u.width,f=u.height,g=c/2,C=f/2,w=s.toHsb();if(!(c===0&&f===0||c!==f)){if(i)switch(i){case"hue":return{x:w.h/360*r-g,y:-C/3};case"alpha":return{x:w.a/1*r-g,y:-C/3}}return{x:w.s*r-g,y:(1-w.b)*l-C}}},Qn=function(e){var t=e.color,s=e.prefixCls,i=e.className,n=e.style,r=e.onClick,l="".concat(s,"-color-block");return G.createElement("div",{className:At(l,i),style:n,onClick:r},G.createElement("div",{className:"".concat(l,"-inner"),style:{background:t}}))};function tr(o){var e="touches"in o?o.touches[0]:o,t=document.documentElement.scrollLeft||document.body.scrollLeft||window.pageXOffset,s=document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset;return{pageX:e.pageX-t,pageY:e.pageY-s}}function go(o){var e=o.offset,t=o.targetRef,s=o.containerRef,i=o.direction,n=o.onDragChange,r=o.onDragChangeComplete,l=o.calculate,u=o.color,c=o.disabledDrag,f=v.useState(e||{x:0,y:0}),g=Ot(f,2),C=g[0],w=g[1],y=v.useRef(null),L=v.useRef(null),x=v.useRef({flag:!1});v.useEffect(function(){if(x.current.flag===!1){var P=l==null?void 0:l(s);P&&w(P)}},[u,s]),v.useEffect(function(){return function(){document.removeEventListener("mousemove",y.current),document.removeEventListener("mouseup",L.current),document.removeEventListener("touchmove",y.current),document.removeEventListener("touchend",L.current),y.current=null,L.current=null}},[]);var T=function(E){var k=tr(E),N=k.pageX,_=k.pageY,Y=s.current.getBoundingClientRect(),Mt=Y.x,bo=Y.y,So=Y.width,Io=Y.height,Ae=t.current.getBoundingClientRect(),ie=Ae.width,ne=Ae.height,Mo=ie/2,yo=ne/2,Ro=Math.max(0,Math.min(N-Mt,So))-Mo,xo=Math.max(0,Math.min(_-bo,Io))-yo,De={x:Ro,y:i==="x"?C.y:xo};if(ie===0&&ne===0||ie!==ne)return!1;w(De),n==null||n(De)},A=function(E){E.preventDefault(),T(E)},R=function(E){E.preventDefault(),x.current.flag=!1,document.removeEventListener("mousemove",y.current),document.removeEventListener("mouseup",L.current),document.removeEventListener("touchmove",y.current),document.removeEventListener("touchend",L.current),y.current=null,L.current=null,r==null||r()},I=function(E){document.removeEventListener("mousemove",y.current),document.removeEventListener("mouseup",L.current),!c&&(T(E),x.current.flag=!0,document.addEventListener("mousemove",A),document.addEventListener("mouseup",R),document.addEventListener("touchmove",A),document.addEventListener("touchend",R),y.current=A,L.current=R)};return[C,I]}var po=function(e){var t=e.size,s=t===void 0?"default":t,i=e.color,n=e.prefixCls;return G.createElement("div",{className:At("".concat(n,"-handler"),we({},"".concat(n,"-handler-sm"),s==="small")),style:{backgroundColor:i}})},vo=function(e){var t=e.children,s=e.style,i=e.prefixCls;return G.createElement("div",{className:"".concat(i,"-palette"),style:rt({position:"relative"},s)},t)},wo=v.forwardRef(function(o,e){var t=o.children,s=o.offset;return G.createElement("div",{ref:e,style:{position:"absolute",left:s.x,top:s.y,zIndex:1}},t)}),er=function(e){var t=e.color,s=e.onChange,i=e.prefixCls,n=e.onChangeComplete,r=e.disabled,l=v.useRef(),u=v.useRef(),c=v.useRef(t),f=go({color:t,containerRef:l,targetRef:u,calculate:function(L){return mo(L,u,t)},onDragChange:function(L){var x=fo({offset:L,targetRef:u,containerRef:l,color:t});c.current=x,s(x)},onDragChangeComplete:function(){return n==null?void 0:n(c.current)},disabledDrag:r}),g=Ot(f,2),C=g[0],w=g[1];return G.createElement("div",{ref:l,className:"".concat(i,"-select"),onMouseDown:w,onTouchStart:w},G.createElement(vo,{prefixCls:i},G.createElement(wo,{offset:C,ref:u},G.createElement(po,{color:t.toRgbString(),prefixCls:i})),G.createElement("div",{className:"".concat(i,"-saturation"),style:{backgroundColor:"hsl(".concat(t.toHsb().h,",100%, 50%)"),backgroundImage:"linear-gradient(0deg, #000, transparent),linear-gradient(90deg, #fff, hsla(0, 0%, 100%, 0))"}})))},sr=function(e){var t=e.colors,s=e.children,i=e.direction,n=i===void 0?"to right":i,r=e.type,l=e.prefixCls,u=v.useMemo(function(){return t.map(function(c,f){var g=gt(c);return r==="alpha"&&f===t.length-1&&g.setAlpha(1),g.toRgbString()}).join(",")},[t,r]);return G.createElement("div",{className:"".concat(l,"-gradient"),style:{position:"absolute",inset:0,background:"linear-gradient(".concat(n,", ").concat(u,")")}},s)},bs=function(e){var t=e.gradientColors,s=e.direction,i=e.type,n=i===void 0?"hue":i,r=e.color,l=e.value,u=e.onChange,c=e.onChangeComplete,f=e.disabled,g=e.prefixCls,C=v.useRef(),w=v.useRef(),y=v.useRef(r),L=go({color:r,targetRef:w,containerRef:C,calculate:function(I){return mo(I,w,r,n)},onDragChange:function(I){var P=fo({offset:I,targetRef:w,containerRef:C,color:r,type:n});y.current=P,u(P)},onDragChangeComplete:function(){c==null||c(y.current,n)},direction:"x",disabledDrag:f}),x=Ot(L,2),T=x[0],A=x[1];return G.createElement("div",{ref:C,className:At("".concat(g,"-slider"),"".concat(g,"-slider-").concat(n)),onMouseDown:A,onTouchStart:A},G.createElement(vo,{prefixCls:g},G.createElement(wo,{offset:T,ref:w},G.createElement(po,{size:"small",color:l,prefixCls:g})),G.createElement(sr,{colors:t,direction:s,type:n,prefixCls:g})))};function Ss(o){return o!==void 0}var or=function(e,t){var s=t.defaultValue,i=t.value,n=v.useState(function(){var c;return Ss(i)?c=i:Ss(s)?c=s:c=e,gt(c)}),r=Ot(n,2),l=r[0],u=r[1];return v.useEffect(function(){i&&u(gt(i))},[i]),[l,u]},ir=["rgb(255, 0, 0) 0%","rgb(255, 255, 0) 17%","rgb(0, 255, 0) 33%","rgb(0, 255, 255) 50%","rgb(0, 0, 255) 67%","rgb(255, 0, 255) 83%","rgb(255, 0, 0) 100%"];const nr=v.forwardRef(function(o,e){var t=o.value,s=o.defaultValue,i=o.prefixCls,n=i===void 0?qn:i,r=o.onChange,l=o.onChangeComplete,u=o.className,c=o.style,f=o.panelRender,g=o.disabledAlpha,C=g===void 0?!1:g,w=o.disabled,y=w===void 0?!1:w,L=or(Jn,{value:t,defaultValue:s}),x=Ot(L,2),T=x[0],A=x[1],R=v.useMemo(function(){var N=gt(T.toRgbString());return N.setAlpha(1),N.toRgbString()},[T]),I=At("".concat(n,"-panel"),u,we({},"".concat(n,"-panel-disabled"),y)),P={prefixCls:n,onChangeComplete:l,disabled:y},E=function(_,Y){t||A(_),r==null||r(_,Y)},k=G.createElement(G.Fragment,null,G.createElement(er,le({color:T,onChange:E},P)),G.createElement("div",{className:"".concat(n,"-slider-container")},G.createElement("div",{className:At("".concat(n,"-slider-group"),we({},"".concat(n,"-slider-group-disabled-alpha"),C))},G.createElement(bs,le({gradientColors:ir,color:T,value:"hsl(".concat(T.toHsb().h,",100%, 50%)"),onChange:function(_){return E(_,"hue")}},P)),!C&&G.createElement(bs,le({type:"alpha",gradientColors:["rgba(255, 0, 4, 0) 0%",R],color:T,value:T.toRgbString(),onChange:function(_){return E(_,"alpha")}},P))),G.createElement(Qn,{color:T.toRgbString(),prefixCls:n})));return G.createElement("div",{className:I,style:c,ref:e},typeof f=="function"?f(k):k)}),rr=({value:o,color:e,onChange:t})=>{const s=n=>n===o,i=n=>s(n)?e??"#666":"#666";return d(Pt,{children:H(K,{container:!0,children:[d(K,{xs:2,xsOffset:2,children:d(Nt,{title:"",enterNextDelay:0,children:d(lt,{color:i(O.SOLID),onClick:()=>{t(O.SOLID)}})})}),d(K,{xs:2,children:d(Nt,{title:"",children:d(lt,{color:i(O.HORIZONTAL),gradientType:O.HORIZONTAL,onClick:()=>{t(O.HORIZONTAL)}})})}),d(K,{xs:2,children:d(Nt,{title:"",children:d(lt,{color:i(O.VERTICAL),gradientType:O.VERTICAL,onClick:()=>{t(O.VERTICAL)}})})}),d(K,{xs:2,children:d(Nt,{title:"",children:d(lt,{color:i(O.RADIAL),gradientType:O.RADIAL,onClick:()=>{t(O.RADIAL)}})})})]})})},Co=v.forwardRef(({colorType:o,close:e},t)=>{const s=Ls(),i=As(),[n,r]=v.useState(!1),l=o==="fillColor"?s:i,u=new Lt(l.primary??"#000000"),c=new Lt(l.secondary??"#000000"),f=n?c:u,g=x=>{o==="fillColor"&&M.store.setState({[o]:x}),o==="strokeColor"&&M.store.setState({[o]:x})},C=x=>{g({...l,primary:(x==null?void 0:x.toHexString())??null})},w=x=>{g({...l,secondary:(x==null?void 0:x.toHexString())??null})},y=ot(x=>{n?w(x):C(x)}),L=v.useMemo(()=>d(nr,{disabledAlpha:!0,prefixCls:"colorpicker",defaultValue:f,onChange:x=>{y(x)}}),[]);return d(Xt,{ref:t,variant:"soft",sx:{bgcolor:x=>x.palette.background.body,boxShadow:x=>x.shadow.md,borderRadius:8,p:2,width:300},children:H(Tt,{gap:1,children:[d(rr,{color:"#673ab7",value:l.gradientType,onChange:x=>{g({...l,gradientType:x})}}),l.gradientType!==O.SOLID&&H(Tt,{direction:"row",justifyContent:"center",children:[d(lt,{color:l.primary,size:"lg",onClick:()=>{r(!1)}}),d(ct,{"aria-label":"switch",color:"primary",sx:{mx:2},onClick:()=>{g({...l,primary:l.secondary,secondary:l.primary})},children:d(ai,{})}),d(lt,{color:l.secondary,size:"lg",onClick:()=>{r(!0)}})]}),L,H(Tt,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[d(lt,{onClick:()=>{y(null)}}),d(li,{children:f.toRgbString()}),d(ct,{"aria-label":"eyedropper",variant:"outlined",disabled:!window.EyeDropper,onClick:()=>{e(),new window.EyeDropper().open().then(({sRGBHex:T})=>{y(new Lt(T))}).catch(T=>{})},children:d(hi,{})})]})]})})}),ar=v.memo(()=>{const o=v.useId(),[e,t]=v.useState(null),s=Ls(),{primary:i,secondary:n,gradientType:r}=s,l=()=>{t(null)},u=c=>{t(c)};return H(Pt,{children:[d(lt,{color:i,secondaryColor:n,gradientType:r,"aria-describedby":o,onClick:c=>{e?l():u(c.currentTarget)}}),d(ee,{id:o,open:!!e,anchor:e,offset:8,children:d(te,{onClickAway:l,touchEvent:"onTouchStart",children:d(Co,{colorType:"fillColor",close:l})})})]})}),Is=v.memo(()=>{const o=j();return d(no,{isActived:o===m.FILL,onClick:()=>{M.ToolsHelper.setMode(m.FILL)}})}),Ms=v.memo(()=>{const e=j()===m.LINE;return d(ro,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.LINE)}})}),ys=v.memo(()=>{const e=j()===m.OVAL;return d(ao,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.OVAL)}})}),Rs=v.memo(()=>{const e=j()===m.RECT;return d(lo,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.RECT)}})}),lr=o=>d(pt,{...o,children:H(It,{viewBox:"0 0 512 512",children:[H("g",{children:[d("polygon",{style:{fill:"#50A5DC"},points:"328.682,350.516 432.553,350.529 258.39,176.366 258.775,418.706   "}),d("path",{d:"M258.772,428.706c-1.307,0-2.624-0.256-3.875-0.782c-3.705-1.558-6.117-5.183-6.123-9.202l-0.384-242.34    c-0.006-4.047,2.428-7.699,6.166-9.251s8.043-0.697,10.905,2.164l174.163,174.163c2.86,2.86,3.716,7.162,2.167,10.898    c-1.548,3.736-5.194,6.173-9.238,6.173h-0.001l-99.802-0.013l-66.994,65.348C263.852,427.723,261.333,428.706,258.772,428.706z    M268.429,200.547l0.309,194.472l52.962-51.661c1.867-1.822,4.373-2.842,6.982-2.842c0.001,0,0.001,0,0.001,0l79.726,0.011    L268.429,200.547z"})]}),d("g",{children:d("path",{d:"M295.705,339.03c-5.522,0-10-4.478-10-10v-61.655c0-5.522,4.478-10,10-10s10,4.478,10,10v61.655    C305.705,334.553,301.228,339.03,295.705,339.03z"})}),d("g",{children:d("path",{d:"M223.19,221.635c-0.365,0-0.734-0.021-1.105-0.061c-10.387-1.143-20.832-2.82-31.044-4.986    c-5.403-1.146-8.854-6.454-7.708-11.857c1.146-5.401,6.455-8.854,11.857-7.707c9.566,2.028,19.35,3.601,29.081,4.67    c5.49,0.604,9.451,5.544,8.847,11.033C232.555,217.845,228.223,221.635,223.19,221.635z"})}),d("rect",{x:"10",y:"93.294",style:{fill:"#FFC10D"},width:"61.1",height:"61.1"}),d("path",{d:"M73.004,164.44c22.778,16.362,47.578,29.629,74.15,39.455c1.144,0.424,2.315,0.624,3.467,0.624   c4.065,0,7.888-2.498,9.38-6.534c1.916-5.181-0.731-10.933-5.911-12.848c-26.272-9.715-50.685-22.954-72.99-39.49V93.294   c0-5.522-4.477-10-10-10H10c-5.523,0-10,4.478-10,10v61.101c0,5.522,4.477,10.045,10,10.045H73.004z M61.1,144.395H20v-41.101h41.1   V144.395z"}),d("rect",{x:"440.9",y:"93.294",style:{fill:"#FFC10D"},width:"61.1",height:"61.1"}),d("path",{d:"M502,164.395c5.522,0,10-4.478,10-10V93.294c0-5.522-4.478-10-10-10h-61.101c-5.522,0-10,4.478-10,10v53.423   c-29.011,21.165-61.681,36.958-96.329,46.38c-5.329,1.449-8.475,6.944-7.025,12.273c1.21,4.451,5.242,7.379,9.644,7.379   c0.868,0,1.752-0.114,2.63-0.354c36.182-9.839,70.343-26.173,100.798-48.016L502,164.395z M450.899,103.294H492v41.101h-41.101   V103.294z"})]})}),xs=v.memo(()=>{const e=j()===m.RESHAPE;return d(lr,{isActived:e,onClick:()=>{M.ToolsHelper.setMode(m.RESHAPE)}})}),Ts=v.memo(()=>{const o=j();return d(ho,{isActived:o===m.SELECT,onClick:()=>{M.ToolsHelper.setMode(m.SELECT)}})}),hr=v.memo(()=>{const o=v.useId(),[e,t]=v.useState(null),s=As(),{primary:i,secondary:n,gradientType:r}=s,l=()=>{t(null)},u=c=>{t(c)};return H(Pt,{children:[d(lt,{color:i,secondaryColor:n,gradientType:r,"aria-describedby":o,onClick:c=>{e?l():u(c.currentTarget)},sx:{":after":{content:'""',position:"absolute",width:"70%",height:"70%",bgcolor:"#fff",border:c=>`1px solid ${c.palette.neutral[300]}`}}}),d(ee,{id:o,open:!!e,anchor:e,offset:8,children:d(te,{onClickAway:l,children:d(Co,{colorType:"strokeColor",close:l})})})]})}),cr=()=>{const o=Qo(),e=j();return d(Xt,{variant:"soft",sx:{p:1,width:100,display:"flex",flexDirection:"column",justifyContent:"flex-start"},children:H(Tt,{gap:1,children:[e===m.SELECT&&d(Ts,{}),e===m.ERASER&&d(gs,{}),e===m.BRUSH&&d(ms,{}),e===m.FILL&&d(Is,{}),e===m.LINE&&d(Ms,{}),e===m.RECT&&d(Rs,{}),e===m.OVAL&&d(ys,{}),e===m.RESHAPE&&d(xs,{}),e===m.BIT_SELECT&&d(fs,{}),e===m.BIT_ERASER&&d(ls,{}),e===m.BIT_BRUSH&&d(as,{}),e===m.BIT_FILL&&d(hs,{}),e===m.BIT_LINE&&d(cs,{}),e===m.BIT_RECT&&d(ds,{}),e===m.BIT_OVAL&&d(us,{}),d(Xe,{}),d(K,{container:!0,spacing:1,children:Yt(o)?[d(Ts,{}),d(Is,{}),d(ms,{}),d(gs,{}),d(xs,{}),d(Ms,{}),d(Rs,{}),d(ys,{})].map((t,s)=>d(K,{xs:6,children:t},s)):[d(fs,{}),d(hs,{}),d(as,{}),d(ls,{}),d(cs,{}),d(us,{}),d(ds,{})].map((t,s)=>d(K,{xs:6,children:t},s))}),d(Xe,{}),H(K,{container:!0,spacing:1,children:[d(K,{xs:6,children:d(ar,{})}),d(K,{xs:6,children:d(hr,{})}),(e===m.BRUSH||e===m.BIT_BRUSH)&&d(K,{xs:12,children:d(Ln,{})}),(e===m.ERASER||e===m.BIT_ERASER)&&d(K,{xs:12,children:d(An,{})})]})]})})},ur=v.memo(()=>{const{canUndo:o,canRedo:e}=ti();return H(zs,{size:"sm",children:[d(ct,{"aria-label":"undo",disabled:!o,onClick:()=>{M.UndoHelper.undo()},children:d(ci,{})}),d(ct,{"aria-label":"redo",disabled:!e,onClick:()=>{M.UndoHelper.redo()},children:d(ui,{})})]})}),dr=v.memo(()=>H(zs,{size:"sm",children:[d(ct,{"aria-label":"zoom in",onClick:()=>{M.ViewHelper.zoomIn()},children:d(di,{})}),d(ct,{"aria-label":"reset zoom",onClick:()=>{M.ViewHelper.resetZoom()},children:d(fi,{})}),d(ct,{"aria-label":"zoom out",onClick:()=>{M.ViewHelper.zoomOut()},children:d(mi,{})})]})),Mr=v.memo(()=>{const o=Ps(),e=Te(),t=ei(),s=e.getTarget(t),i=Bs(),n=(s==null?void 0:s.costumes.findIndex(g=>g.id===(i==null?void 0:i.id)))??-1,r=v.useRef(null);v.useEffect(()=>{const g=async()=>{if(M.UndoHelper.snapshot(M.store.paintFormat),M.store.paintFormat===ht.BITMAP){const C=await M.BitMapHelper.exportImage();if(C){const{imageBitmap:w,rotationCenter:y}=C;e.updateCostume(t,n,w,y)}}else{const{svg:C,rotationCenter:w}=M.SvgHelper.exportImage();e.updateCostume(t,n,C,w)}};return M.on("Image",g),()=>{M.off("Image",g)}},[e,t,n]),v.useEffect(()=>{if(r.current)return M.attachDispatch(o),M.setup(r.current),()=>{M.dispose()}},[o]);const{id:l,rotationCenter:u,resolution:c,asset:{data:f}}=e.getCostumeInfo(t,n);return v.useEffect(()=>{if(f)return M.clear(),f instanceof ImageBitmap?(M.setFormat(ht.BITMAP),M.BitMapHelper.importImage(f,c,u).then(()=>{M.ViewHelper.zoomToFitMaybe(t,!0)})):(M.setFormat(ht.VECTOR),M.SvgHelper.importImage(f,u).then(()=>{M.ViewHelper.zoomToFitMaybe(t,!1)})),()=>{M.ViewHelper.recordZoom(t)}},[l]),H(Xt,{variant:"outlined",sx:{display:"flex",flex:1,borderTopLeftRadius:8,overflow:"hidden",borderBottom:"none"},children:[d(wi,{targetId:t}),d(cr,{}),H(it,{sx:{flex:1,p:3},children:[H(Xt,{variant:"outlined",color:"neutral",sx:{position:"relative",height:"calc(100% - 1rem)",width:"100%",borderRadius:8,overflow:"hidden"},children:[d(Tn,{ref:r}),d(Bn,{})]}),H(Tt,{sx:{mt:.5},direction:"row-reverse",gap:1,children:[d(dr,{}),d(ur,{})]})]})]})});export{Mr as default};
